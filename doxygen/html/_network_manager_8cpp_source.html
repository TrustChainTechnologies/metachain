<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TCT: src/network/NetworkManager.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="TrustChainLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TCT
   &#160;<span id="projectnumber">v1.0</span>
   </div>
   <div id="projectbrief">MetaChain</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_network_manager_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">NetworkManager.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_network_manager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*********************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">* Copyright (c) 2017 TCT DEVs                                        *</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">* Distributed under the GPLv3.0 software license                     *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">* contact us before using our code                                   *</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">**********************************************************************/</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_network_manager_8h.html">NetworkManager.h</a>&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;exception&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;mutex&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;thread&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;list&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;../MetaChain.h&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;../defines.h&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;../logger.h&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;../cSemaphore.h&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;../io/ipContainer.h&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;../io/netPeers.h&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;../functions.h&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_c_net_addr_8h.html">CNetAddr.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_c_service_8h.html">CService.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;../tinyformat.h&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="net_message_8h.html">netMessage.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;../cCriticalSection.h&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="class_network_manager.html#a118413bb02740da31598bca051b3e98b">   27</a></span>&#160;<a class="code" href="class_network_manager.html#a118413bb02740da31598bca051b3e98b">NetworkManager::NetworkManager</a>(<a class="code" href="class_meta_chain.html">MetaChain</a> *mc) :</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    m_pMC(mc),</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    m_iNetConnectTimeout(<a class="code" href="defines_8h.html#a8eaf06e7d68fc5e5bdeeafcbe1f8bc76">NET_DEFAULT_CONNECT_TIMEOUT</a>),</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    m_bActiveNetwork(<a class="code" href="_convert_u_t_f_8c.html#a65e9886d74aaee76545e83dd09011727">false</a>),</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    m_iTimeBetweenConnects(0),</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    m_pSemOutbound(NULL),</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    m_pSemInbound(NULL),</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    m_iMaxOutboundConnections(0),</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    m_iMaxInboundConnections(0)</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;{</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#ifdef _DEBUG</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="logger_8h.html#ae1641999093a47ba019589c5dad08770">LOG_DEBUG</a>(<span class="stringliteral">&quot;instantiate NetworkManager&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;}</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="class_network_manager.html#af06f1b25c87391d423a243f1bd2cbc3d">   42</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_network_manager.html#af06f1b25c87391d423a243f1bd2cbc3d">NetworkManager::initialize</a>(<a class="code" href="class_c_simple_ini_templ.html">CSimpleIniA</a>* iniFile)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#ifdef _DEBUG</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="logger_8h.html#ae1641999093a47ba019589c5dad08770">LOG_DEBUG</a>(<span class="stringliteral">&quot;initializing NetworkManager&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// read the default connect timeout from the settings, if it&#39;s not set, we&#39;ll use our default value</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="class_network_manager.html#accc4aa063b5d44ea39d517337095f24f">m_iNetConnectTimeout</a> = iniFile-&gt;<a class="code" href="class_c_simple_ini_templ.html#a7fa211c1c768497520eab7f2014ae786">GetLongValue</a>(<span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;connect_timeout&quot;</span>, <a class="code" href="defines_8h.html#a8eaf06e7d68fc5e5bdeeafcbe1f8bc76">NET_DEFAULT_CONNECT_TIMEOUT</a>);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// read the time in seconds between two connects that were not succesfull</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="class_network_manager.html#a4a585d43b4a2ac8916a615c6c472f6d7">m_iTimeBetweenConnects</a> = iniFile-&gt;<a class="code" href="class_c_simple_ini_templ.html#a7fa211c1c768497520eab7f2014ae786">GetLongValue</a>(<span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;time_between_unsuccessfull_connects&quot;</span>, <a class="code" href="defines_8h.html#a72426049acbc67e4b2adc06722ad19f0">NET_DEFAULT_TIME_BETWEEN_UNSUCCESSFUL</a>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// read the max outbound connections</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="class_network_manager.html#afb627137857f6ef3b19fc1208a876907">m_iMaxOutboundConnections</a> = iniFile-&gt;<a class="code" href="class_c_simple_ini_templ.html#a7fa211c1c768497520eab7f2014ae786">GetLongValue</a>(<span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;max_outgoing_connections&quot;</span>, <a class="code" href="defines_8h.html#a399f8172f8495a5d0904c6040e471a1e">NET_DEFAULT_MAX_OUTGOING_CONNECTIONS</a>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// read the max total connections</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="class_network_manager.html#a9514edceb8d142c01724322d36f42062">m_iMaxInboundConnections</a> = iniFile-&gt;<a class="code" href="class_c_simple_ini_templ.html#a7fa211c1c768497520eab7f2014ae786">GetLongValue</a>(<span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;max_incoming_connections&quot;</span>, <a class="code" href="defines_8h.html#a133e7d33cddac993d3357690aa64c797">NET_DEFAULT_MAX_INCOMING_CONNECTIONS</a>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// initialize the semaphores</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="class_network_manager.html#a5ed61b32dd67cce5b0d03d017d380484">m_pSemOutbound</a> = <span class="keyword">new</span> <a class="code" href="classc_semaphore.html">cSemaphore</a>(<a class="code" href="class_network_manager.html#afb627137857f6ef3b19fc1208a876907">m_iMaxOutboundConnections</a>);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="class_network_manager.html#a836732e6ad8589afc2f6119b98eb4de6">m_pSemInbound</a> = <span class="keyword">new</span> <a class="code" href="classc_semaphore.html">cSemaphore</a>(<a class="code" href="class_network_manager.html#a9514edceb8d142c01724322d36f42062">m_iMaxInboundConnections</a>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// Initialize Windows Sockets</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    WSADATA wsadata;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordtype">int</span> ret = WSAStartup(MAKEWORD(2, 2), &amp;wsadata);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">if</span> (ret != NO_ERROR || LOBYTE(wsadata.wVersion) != 2 || HIBYTE(wsadata.wVersion) != 2)</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// initialize the ban list</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;initializing the Ban List&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="class_network_manager.html#a47bfd57a878ecad468b8f26dc6224d03">m_lstBanList</a> = <a class="code" href="classip_container.html">ipContainer&lt; CNetAddr &gt;</a>(iniFile-&gt;<a class="code" href="class_c_simple_ini_templ.html#a74e3f5d22f50b70b2a20c89ec7e2c737">GetValue</a>(<span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;ban_file&quot;</span>, <span class="stringliteral">&quot;bans.dat&quot;</span>));</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="class_network_manager.html#a47bfd57a878ecad468b8f26dc6224d03">m_lstBanList</a>.<a class="code" href="classip_container.html#a070a13e7de2e032349abc22a5533776f">readContents</a>();</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// initialize the outbound peer list</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;initializing the Peer List&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a> = <a class="code" href="classip_container.html">ipContainer&lt; netPeers &gt;</a>(iniFile-&gt;<a class="code" href="class_c_simple_ini_templ.html#a74e3f5d22f50b70b2a20c89ec7e2c737">GetValue</a>(<span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;peer_file&quot;</span>, <span class="stringliteral">&quot;peers.dat&quot;</span>));</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a070a13e7de2e032349abc22a5533776f">readContents</a>();</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// initialize the inbound peer list (which is ofc empty at start, but we attach it to the same file as the outbound peer list so that we can sync FN nodes into the same file)</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">m_lstPeerListIn</a> = <a class="code" href="classip_container.html">ipContainer&lt; netPeers &gt;</a>(iniFile-&gt;<a class="code" href="class_c_simple_ini_templ.html#a74e3f5d22f50b70b2a20c89ec7e2c737">GetValue</a>(<span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;peer_file&quot;</span>, <span class="stringliteral">&quot;peers.dat&quot;</span>));</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// creating a CService class for the listener and storing it for further purposes</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">try</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a> = <span class="keyword">new</span> <a class="code" href="class_c_service.html">CService</a>(iniFile-&gt;<a class="code" href="class_c_simple_ini_templ.html#a74e3f5d22f50b70b2a20c89ec7e2c737">GetValue</a>(<span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;listening_ip&quot;</span>, <a class="code" href="defines_8h.html#ad20a801741bd20aee6186d189f0506dd">NET_STANDARD_CATCHALL_LISTENING</a>), (<span class="keywordtype">unsigned</span> short)iniFile-&gt;<a class="code" href="class_c_simple_ini_templ.html#a7fa211c1c768497520eab7f2014ae786">GetLongValue</a>(<span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;listening_port&quot;</span>, <a class="code" href="defines_8h.html#af1ec4e1407f8eabfb9ac1fbf113f9cac">NET_STANDARD_PORT_LISTENING</a>));</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="comment">// if we have a testnet, we increment the listening port by 100 to ensure no conflicts happen when a real and a testnet node are on the same system.</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_meta_chain.html#a9c97062a7a5fc71592e9bdcf4a07d3ba">MetaChain::getInstance</a>().<a class="code" href="class_meta_chain.html#a4631a8e5ac66d05bb8c688900e2eb1d7">isTestNet</a>())</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a>-&gt;<a class="code" href="class_c_service.html#a3dedc3f12aa21bdbf1068b054d3e3d39">SetPort</a>(<a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a>-&gt;<a class="code" href="class_c_service.html#a71caa0d6aa6ab12758bde8b6a6bcfd2a">GetPort</a>() + 100);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">catch</span> (std::exception e)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;That wasn&#39;t good. An error occured creating the local service listener. Please check your configuration file.&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// now we start the listening socket</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="class_network_manager.html#a3dc6503bbd3b96fa973d699fbb38e06e">startListeningSocket</a>())</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    {</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;Not able to bind listening Socket&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// start the threads for network communication</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;Starting networking threads&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="class_network_manager.html#af7326c9d0cefa365670eb3f9ec6d0e27">startThreads</a>();</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// everything went smoothly</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="class_network_manager.html#ab6e9b8711788bbfb340738ff92b302be">m_bActiveNetwork</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;}</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="class_network_manager.html#a3dc6503bbd3b96fa973d699fbb38e06e">  116</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_network_manager.html#a3dc6503bbd3b96fa973d699fbb38e06e">NetworkManager::startListeningSocket</a>()</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;{</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordtype">int</span> nOne = 1;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// Create socket for listening for incoming connections</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keyword">struct </span>sockaddr_storage sockaddr;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    socklen_t len = <span class="keyword">sizeof</span>(sockaddr);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a>-&gt;<a class="code" href="class_c_service.html#ac4c6d655fab3af40937f0b0c65581745">GetSockAddr</a>((<span class="keyword">struct</span> sockaddr*)&amp;sockaddr, &amp;len))</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;Bind address family not supported - &quot;</span> + <a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a>-&gt;<a class="code" href="class_c_service.html#a27dd2cf9191d05c1b1d870d64b42388c">toString</a>(), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a> = socket(((<span class="keyword">struct</span> sockaddr*)&amp;sockaddr)-&gt;sa_family, SOCK_STREAM, IPPROTO_TCP);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a> == <a class="code" href="defines_8h.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>)</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;Couldn&#39;t open socket for incoming connections - Socket error: &quot;</span> + <a class="code" href="functions_8cpp.html#a8ddb7d8d6e5b5cfabfdeea132f556977">NetworkErrorString</a>(<a class="code" href="defines_8h.html#a6d24fe3ab2906c21c373505ca244f90b">WSAGetLastError</a>()), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#ifndef _WIN32</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor">#ifdef SO_NOSIGPIPE</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// Different way of disabling SIGPIPE on BSD</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    setsockopt(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, SOL_SOCKET, SO_NOSIGPIPE, (<span class="keywordtype">void</span>*)&amp;nOne, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// Allow binding if the port is still in TIME_WAIT state after</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// the program was closed and restarted.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    setsockopt(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, SOL_SOCKET, SO_REUSEADDR, (<span class="keywordtype">void</span>*)&amp;nOne, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// Disable Nagle&#39;s algorithm</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    setsockopt(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, IPPROTO_TCP, TCP_NODELAY, (<span class="keywordtype">void</span>*)&amp;nOne, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    setsockopt(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, SOL_SOCKET, SO_REUSEADDR, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;nOne, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    setsockopt(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, IPPROTO_TCP, TCP_NODELAY, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;nOne, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// Set to non-blocking, incoming connections will also inherit this</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="functions_8cpp.html#a6c44614cb5f9293d8419248a0b72d4b0">SetSocketNonBlocking</a>(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, <span class="keyword">true</span>))</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <a class="code" href="functions_8cpp.html#aeb0961aecb19bbca063c3514b25b20c9">CloseSocket</a>(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;BindListenPort: Setting listening socket to non-blocking failed - &quot;</span> + <a class="code" href="functions_8cpp.html#a8ddb7d8d6e5b5cfabfdeea132f556977">NetworkErrorString</a>(<a class="code" href="defines_8h.html#a6d24fe3ab2906c21c373505ca244f90b">WSAGetLastError</a>()), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// some systems don&#39;t have IPV6_V6ONLY but are always v6only; others do have the option</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// and enable it by default or not. Try to enable it, if possible.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a>-&gt;<a class="code" href="class_c_net_addr.html#aad5f7a372c56ccf4d773f728b6b46e18">IsIPv6</a>())</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor">#ifdef IPV6_V6ONLY</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        setsockopt(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, IPPROTO_IPV6, IPV6_V6ONLY, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;nOne, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        setsockopt(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, IPPROTO_IPV6, IPV6_V6ONLY, (<span class="keywordtype">void</span>*)&amp;nOne, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordtype">int</span> nProtLevel = PROTECTION_LEVEL_UNRESTRICTED;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        setsockopt(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, IPPROTO_IPV6, IPV6_PROTECTION_LEVEL, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;nProtLevel, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span> (::bind(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, (<span class="keyword">struct</span> sockaddr*)&amp;sockaddr, len) == <a class="code" href="defines_8h.html#a633b0396ff93d336a088412a190a5072">SOCKET_ERROR</a>)</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordtype">int</span> nErr = <a class="code" href="defines_8h.html#a6d24fe3ab2906c21c373505ca244f90b">WSAGetLastError</a>();</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span> (nErr == <a class="code" href="defines_8h.html#ae57d56be40e06a6148c41bb9c1f66eb6">WSAEADDRINUSE</a>)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>( <a class="code" href="tinyformat_8h.html#a56c674871a61baaad36ad52238c08857">strprintf</a>(<span class="stringliteral">&quot;Unable to bind to %s on this computer. A process is already running.&quot;</span>, <a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a>-&gt;<a class="code" href="class_c_service.html#a27dd2cf9191d05c1b1d870d64b42388c">toString</a>() ), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>( <a class="code" href="tinyformat_8h.html#a56c674871a61baaad36ad52238c08857">strprintf</a>(<span class="stringliteral">&quot;Unable to bind to %s on this computer (bind returned error %s)&quot;</span>, <a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a>-&gt;<a class="code" href="class_c_service.html#a27dd2cf9191d05c1b1d870d64b42388c">toString</a>(), <a class="code" href="functions_8cpp.html#a8ddb7d8d6e5b5cfabfdeea132f556977">NetworkErrorString</a>(nErr)), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            </div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="functions_8cpp.html#aeb0961aecb19bbca063c3514b25b20c9">CloseSocket</a>(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>( <span class="stringliteral">&quot;Bound to &quot;</span> + <a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a>-&gt;<a class="code" href="class_c_service.html#a27dd2cf9191d05c1b1d870d64b42388c">toString</a>(), <span class="stringliteral">&quot;NET&quot;</span> );</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// Listen for incoming connections</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">if</span> (listen(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, SOMAXCONN) == <a class="code" href="defines_8h.html#a633b0396ff93d336a088412a190a5072">SOCKET_ERROR</a>)</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>( <a class="code" href="tinyformat_8h.html#a56c674871a61baaad36ad52238c08857">strprintf</a>(<span class="stringliteral">&quot;Listening for incoming connections failed (listen returned error %s)&quot;</span>, <a class="code" href="functions_8cpp.html#a8ddb7d8d6e5b5cfabfdeea132f556977">NetworkErrorString</a>(<a class="code" href="defines_8h.html#a6d24fe3ab2906c21c373505ca244f90b">WSAGetLastError</a>())), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="functions_8cpp.html#aeb0961aecb19bbca063c3514b25b20c9">CloseSocket</a>(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    </div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="class_network_manager.html#af7326c9d0cefa365670eb3f9ec6d0e27">  200</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#af7326c9d0cefa365670eb3f9ec6d0e27">NetworkManager::startThreads</a>()</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;{</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;Starting Threads&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>.<a class="code" href="class_c_thread_interrupt.html#a399a6b881ef3e107eb956239679c5026">reset</a>();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="class_network_manager.html#ad519fe4c3fef08ebc88324a53a0ceea8">m_abflagInterruptMsgProc</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        boost::unique_lock&lt;boost::mutex&gt; lock(<a class="code" href="class_network_manager.html#abae29b81b32efa712838f52f8aabf236">m_mutexMsgProc</a>);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="class_network_manager.html#a7509c0b86351780fd092cf433f9795e6">m_bfMsgProcWake</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// Send and receive from sockets, accept connections</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="class_network_manager.html#ad5d22fe6eb481e5998e8c455da540aba">threadSocketHandler</a> = std::thread(&amp;<a class="code" href="functions_8h.html#ac481a378af0229bf71e3d9fee7b938ad">TraceThread</a>&lt;std::function&lt;<span class="keywordtype">void</span>()&gt; &gt;, <span class="stringliteral">&quot;net&quot;</span>, std::function&lt;<span class="keywordtype">void</span>()&gt;(std::bind(&amp;<a class="code" href="class_network_manager.html#ac0b1d84b9a23c78586d18e2d8ca8e344">NetworkManager::ThreadSocketHandler</a>, <span class="keyword">this</span>)));</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    </div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// Initiate outbound connections</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="class_network_manager.html#a31005bfe5cde2c6e935c506ee881141d">threadOpenConnections</a> = std::thread(&amp;<a class="code" href="functions_8h.html#ac481a378af0229bf71e3d9fee7b938ad">TraceThread</a>&lt;std::function&lt;<span class="keywordtype">void</span>()&gt; &gt;, <span class="stringliteral">&quot;opencon&quot;</span>, std::function&lt;<span class="keywordtype">void</span>()&gt;(std::bind(&amp;<a class="code" href="class_network_manager.html#a7838157f0e49e77f015a9326c23746b1">NetworkManager::ThreadOpenConnections</a>, <span class="keyword">this</span>)));</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// Process messages</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="class_network_manager.html#a5c460478d30acee5d5bd9082b9eb40cb">threadMessageHandler</a> = std::thread(&amp;<a class="code" href="functions_8h.html#ac481a378af0229bf71e3d9fee7b938ad">TraceThread</a>&lt;std::function&lt;<span class="keywordtype">void</span>()&gt; &gt;, <span class="stringliteral">&quot;msghand&quot;</span>, std::function&lt;<span class="keywordtype">void</span>()&gt;(std::bind(&amp;<a class="code" href="class_network_manager.html#af5e6b64265dc0147775f524a01e6d6f1">NetworkManager::ThreadMessageHandler</a>, <span class="keyword">this</span>)));</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">// Dump network addresses with a lightweight scheduler</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="class_network_manager.html#ae09548303d78f6f3f97b8722e5685205">m_pMC</a>-&gt;<a class="code" href="class_meta_chain.html#afb2672d138af6a985e9279db39029bc7">getScheduler</a>()-&gt;<a class="code" href="class_c_scheduler.html#aab114cb7085474e0f1a47aa2b54e9cae">scheduleEvery</a>(std::bind(&amp;<a class="code" href="class_network_manager.html#ad19c25f249c8f7e21436fdd0914c5635">NetworkManager::DumpData</a>, <span class="keyword">this</span>), <a class="code" href="defines_8h.html#a407ce4b9e4c1645103d055c0eca8f5ed">DUMP_INTERVAL</a> * 1000);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="class_network_manager.html#ac0b1d84b9a23c78586d18e2d8ca8e344">  225</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#ac0b1d84b9a23c78586d18e2d8ca8e344">NetworkManager::ThreadSocketHandler</a>()</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;{</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        fd_set fdsetRecv;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        fd_set fdsetSend;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        fd_set fdsetError;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        FD_ZERO(&amp;fdsetRecv);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        FD_ZERO(&amp;fdsetSend);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        FD_ZERO(&amp;fdsetError);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keyword">struct </span>timeval timeout;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        timeout.tv_sec = 0;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        timeout.tv_usec = 50000; <span class="comment">// frequency to poll</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                </div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="comment">// flag the listening socket to read from him for new connections   </span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        FD_SET(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, &amp;fdsetRecv);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordtype">int</span> nSelect = select(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a> + 1, &amp;fdsetRecv, &amp;fdsetSend, &amp;fdsetError, &amp;timeout);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span> (nSelect == <a class="code" href="defines_8h.html#a633b0396ff93d336a088412a190a5072">SOCKET_ERROR</a>)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="keywordtype">int</span> nErr = <a class="code" href="defines_8h.html#a6d24fe3ab2906c21c373505ca244f90b">WSAGetLastError</a>();</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;socket select error - &quot;</span> + <a class="code" href="functions_8cpp.html#a8ddb7d8d6e5b5cfabfdeea132f556977">NetworkErrorString</a>(nErr), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt;= (<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>+1); i++)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                FD_SET(i, &amp;fdsetRecv);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            FD_ZERO(&amp;fdsetSend);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            FD_ZERO(&amp;fdsetError);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>.<a class="code" href="class_c_thread_interrupt.html#a6118393076e75866a688bb64ef4a1e63">sleep_for</a>(std::chrono::milliseconds(timeout.tv_usec / 1000)))</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">// Accept new connections</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a> != <a class="code" href="defines_8h.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a> &amp;&amp; FD_ISSET(<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, &amp;fdsetRecv))</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="class_network_manager.html#a405f2efdf4f337703c2a0f1de03868ae">m_csPeerListIn</a>);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <a class="code" href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">m_lstPeerListIn</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.emplace_back(&amp;<a class="code" href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">m_hListenSocket</a>, <a class="code" href="class_network_manager.html#a836732e6ad8589afc2f6119b98eb4de6">m_pSemInbound</a>);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <a class="code" href="classnet_peers.html">netPeers</a> *newElem = &amp;<a class="code" href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">m_lstPeerListIn</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.back();</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            newElem-&gt;<a class="code" href="classnet_peers.html#a0e75bc21792d0efcd61869cca3c03c83">mark</a>();</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="comment">// todo: when c++17 is adopted into compilers, use the reference returned from emplace_back instead of using the back() function.            </span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="comment">// check if the ip address isnt banned</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <a class="code" href="class_c_net_addr.html">CNetAddr</a> addr = (<a class="code" href="class_c_net_addr.html">CNetAddr</a>)newElem-&gt;<a class="code" href="classnet_peers.html#a2984e69e23bc63aabeede92b07d8639e">csAddress</a>;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            if (!newElem-&gt;<a class="code" href="classnet_peers.html#a1d22d688a864ba859b06f7b34d51b01e">toDestroy</a>() &amp;&amp; <a class="code" href="class_network_manager.html#a47bfd57a878ecad468b8f26dc6224d03">m_lstBanList</a>.<a class="code" href="classip_container.html#adbfd3103fc17563d8d2b4d17c351902a">entryExists</a>(&amp;addr) )</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;connection dropped - banned - &quot;</span> + newElem-&gt;<a class="code" href="classnet_peers.html#a2984e69e23bc63aabeede92b07d8639e">csAddress</a>.<a class="code" href="class_c_net_addr.html#a09168d1f3620bcb0ef396359d5764e54">toStringIP</a>(), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                newElem-&gt;<a class="code" href="classnet_peers.html#a0a16c3adbdb484356928cad339b8f06a">markDestroy</a>();</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="comment">// after we successfully received a connection, we send them our version info so that they know how to talk to us</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(newElem-&gt;<a class="code" href="classnet_peers.html#a4414640b4daa656cae91bf93f5e25517">pcsvSend</a>);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            newElem-&gt;<a class="code" href="classnet_peers.html#a50b253a49909c8a0e3da923d8c4c73c0">listSend</a>.emplace_back( netMessage::SUBJECT::NET_VERSION, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="defines_8h.html#a04c0a9ba8228218f9a3de694ce624e8a">g_cuint32tVersion</a>, <span class="keyword">sizeof</span>(g_cuint32tVersion), <span class="keyword">true</span>);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            newElem-&gt;<a class="code" href="classnet_peers.html#ac3c5825cf4947b284f22c1e6eccfcab5">unmark</a>();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="comment">// inbound and outbound socket handling</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="class_network_manager.html#a336caef94fed1e40fae5a1126029a5c4">handlePeers</a>(&amp;<a class="code" href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">m_lstPeerListIn</a>, &amp;<a class="code" href="class_network_manager.html#a405f2efdf4f337703c2a0f1de03868ae">m_csPeerListIn</a>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <a class="code" href="class_network_manager.html#a336caef94fed1e40fae5a1126029a5c4">handlePeers</a>(&amp;<a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>, &amp;<a class="code" href="class_network_manager.html#a75a0ee3afcd4d25adb9ff6bbb323b35c">m_csPeerListOut</a>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="class_network_manager.html#a336caef94fed1e40fae5a1126029a5c4">  288</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#a336caef94fed1e40fae5a1126029a5c4">NetworkManager::handlePeers</a>(<a class="code" href="classip_container.html">ipContainer&lt; netPeers&gt;</a> *peers, <a class="code" href="classc_critical_section.html">cCriticalSection</a> *<a class="code" href="namespace_m_c_p39_1_1language.html#a25b18d0c40153e6617136bc2e63b49e7">cs</a>)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;{</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    fd_set fdsetRecv;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    fd_set fdsetSend;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    fd_set fdsetError;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    FD_ZERO(&amp;fdsetRecv);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    FD_ZERO(&amp;fdsetSend);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    FD_ZERO(&amp;fdsetError);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keyword">struct </span>timeval timeout;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    timeout.tv_sec = 0;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    timeout.tv_usec = 50000; <span class="comment">// frequency to poll</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <a class="code" href="defines_8h.html#ab8a4083c1e5d7c4172936f59e67ce798">SOCKET</a> hSocketMax = 0;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// first delete nodes that disconnected gracefully or on error</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(cs);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">for</span> (std::list&lt; netPeers &gt;::iterator <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> = peers-&gt;<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.begin(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> != peers-&gt;<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.end(); )</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;toDestroy() || ( (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket == <a class="code" href="defines_8h.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>) &amp;&amp; <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;isConnected())) &amp;&amp; !<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;inUse() )</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> = peers-&gt;<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.erase(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>++;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        }</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }   </div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// prepare the sockets for receiving and sending data (if necessary)</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(cs);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">for</span> (std::list&lt; netPeers &gt;::iterator <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> = peers-&gt;<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.begin(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> != peers-&gt;<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.end(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>++)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;mark();</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="comment">// check whether the socket is connected</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;isConnected())</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="comment">// check if the peer has something to send</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordtype">bool</span> select_send;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;pcsvSend);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                select_send = !<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;listSend.empty();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;pcshSocket);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket == <a class="code" href="defines_8h.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>)</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            FD_SET(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket, &amp;fdsetError);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            hSocketMax = (std::max)(hSocketMax, <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <span class="comment">// when we have to send something, we dont receive this round</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            <span class="keywordflow">if</span> (select_send)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                FD_SET(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket, &amp;fdsetSend);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            <span class="comment">// we always try to receive data unless we send data</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            FD_SET(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket, &amp;fdsetRecv);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// when we have no sockets to work with, or have only non connected sockets, we skip the rest of the function</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span> (hSocketMax == 0)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordtype">int</span> nSelect = select(hSocketMax + 1, &amp;fdsetRecv, &amp;fdsetSend, &amp;fdsetError, &amp;timeout);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> (nSelect == <a class="code" href="defines_8h.html#a633b0396ff93d336a088412a190a5072">SOCKET_ERROR</a>)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordtype">int</span> nErr = <a class="code" href="defines_8h.html#a6d24fe3ab2906c21c373505ca244f90b">WSAGetLastError</a>();</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;socket select error - &quot;</span> + <a class="code" href="functions_8cpp.html#a8ddb7d8d6e5b5cfabfdeea132f556977">NetworkErrorString</a>(nErr), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt;= hSocketMax; i++)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            FD_SET(i, &amp;fdsetRecv);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        FD_ZERO(&amp;fdsetSend);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        FD_ZERO(&amp;fdsetError);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>.<a class="code" href="class_c_thread_interrupt.html#a6118393076e75866a688bb64ef4a1e63">sleep_for</a>(std::chrono::milliseconds(timeout.tv_usec / 1000)))</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">// socket handling (read, write, timeout)</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(cs);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">for</span> (std::list&lt; netPeers &gt;::iterator <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> = peers-&gt;<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.begin(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> != peers-&gt;<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.end(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>++)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;mark();</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="comment">// is this peer about to be destroyed? if so, dont work with it</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="comment">// also when there are too many messages, skip the reading</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;toDestroy() || <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;readStop() || !<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;isConnected())</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="comment">// check for send and receive flags</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordtype">bool</span> recvSet = <span class="keyword">false</span>;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordtype">bool</span> sendSet = <span class="keyword">false</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordtype">bool</span> errorSet = <span class="keyword">false</span>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;pcshSocket);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket == <a class="code" href="defines_8h.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>)</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;markDestroy();</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            }</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            recvSet = FD_ISSET(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket, &amp;fdsetRecv);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            sendSet = FD_ISSET(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket, &amp;fdsetSend);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            errorSet = FD_ISSET(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket, &amp;fdsetError);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="comment">// Receive</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">if</span> (recvSet || errorSet)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="comment">// typical socket buffer is 8K-64K</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordtype">char</span> pchBuf[0x10000];</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordtype">int</span> nBytes = 0;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;pcshSocket);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket == <a class="code" href="defines_8h.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>)</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                    <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;markDestroy();</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                    <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                nBytes = recv(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket, pchBuf, <span class="keyword">sizeof</span>(pchBuf), <a class="code" href="defines_8h.html#ab18d3d439e4a9c8d0f73e7166e8eb376">MSG_DONTWAIT</a>);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="keywordflow">if</span> (nBytes &gt; 0)</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            {</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                <span class="keywordtype">bool</span> bNotifyWake = <span class="keyword">false</span>;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;ReceiveMsgBytes(pchBuf, nBytes, bNotifyWake))</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;markDestroy();</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                <span class="keywordflow">if</span> (bNotifyWake)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    <a class="code" href="class_network_manager.html#a68c600feeef71671d133c88c7c32da4a">WakeMessageHandler</a>();</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nBytes == 0)</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            {</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                <span class="comment">// socket closed gracefully</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;markDestroy();</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;socket closed&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nBytes &lt; 0)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                <span class="comment">// error</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keywordtype">int</span> nErr = <a class="code" href="defines_8h.html#a6d24fe3ab2906c21c373505ca244f90b">WSAGetLastError</a>();</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                <span class="keywordflow">if</span> (nErr != <a class="code" href="defines_8h.html#a4ba23242bee4784b72a0a170e2f975a0">WSAEWOULDBLOCK</a> &amp;&amp; nErr != <a class="code" href="defines_8h.html#a7ce1c171e08d68442124bf6189f8aec5">WSAEMSGSIZE</a> &amp;&amp; nErr != <a class="code" href="defines_8h.html#aef81890a7d46cb9dda85df9b96cba6b1">WSAEINTR</a> &amp;&amp; nErr != <a class="code" href="defines_8h.html#ada8711ffab59910a2732cfa4b7c24e29">WSAEINPROGRESS</a>)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                    <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;markDestroy();</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                    <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;socket recv error - &quot;</span> + <a class="code" href="functions_8cpp.html#a8ddb7d8d6e5b5cfabfdeea132f556977">NetworkErrorString</a>(nErr), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                }</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="comment">// Send</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keywordflow">if</span> (sendSet &amp;&amp; (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket != <a class="code" href="defines_8h.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>))</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;pcsvSend);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            std::list&lt; netMessage &gt;::iterator msg = <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;listSend.begin();</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordtype">size_t</span> nSentSize = 0;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">while</span> (msg != <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;listSend.end())</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                <span class="keywordtype">int</span> nBytes = 0;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                    <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;pcshSocket);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                    nBytes = send(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hSocket, reinterpret_cast&lt;const char*&gt;(msg-&gt;getPackage()) + nSentSize, msg-&gt;getPackageSize() - nSentSize, <a class="code" href="defines_8h.html#a9f55d0e90dc8cc6b2287312435cdde48">MSG_NOSIGNAL</a> | <a class="code" href="defines_8h.html#ab18d3d439e4a9c8d0f73e7166e8eb376">MSG_DONTWAIT</a>);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                <span class="keywordflow">if</span> (nBytes &gt; 0)</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                    nSentSize += nBytes;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                    <span class="keywordflow">if</span> (nSentSize == msg-&gt;getPackageSize())</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                    {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                        <span class="comment">// msg fully sent</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                        nSentSize = 0;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                        msg++;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                    }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                        <span class="comment">// msg not fully sent, next try!</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    <span class="keywordflow">if</span> (nBytes &lt; 0)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                    {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                        <span class="keywordtype">int</span> nErr = <a class="code" href="defines_8h.html#a6d24fe3ab2906c21c373505ca244f90b">WSAGetLastError</a>();</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                        <span class="keywordflow">if</span> (nErr != <a class="code" href="defines_8h.html#a4ba23242bee4784b72a0a170e2f975a0">WSAEWOULDBLOCK</a> &amp;&amp; nErr != <a class="code" href="defines_8h.html#a7ce1c171e08d68442124bf6189f8aec5">WSAEMSGSIZE</a> &amp;&amp; nErr != <a class="code" href="defines_8h.html#aef81890a7d46cb9dda85df9b96cba6b1">WSAEINTR</a> &amp;&amp; nErr != <a class="code" href="defines_8h.html#ada8711ffab59910a2732cfa4b7c24e29">WSAEINPROGRESS</a>)</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                        {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                            <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;markDestroy();</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                            <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;socket send error - &quot;</span> + <a class="code" href="functions_8cpp.html#a8ddb7d8d6e5b5cfabfdeea132f556977">NetworkErrorString</a>(nErr), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                        }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                    }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                    <span class="comment">// couldn&#39;t send anything at all</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <span class="comment">// remove the sent messages</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;listSend.erase(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;listSend.begin(), msg);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">        //</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">        // Inactivity checking</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">        //</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">        int64_t nTime = GetSystemTimeInSeconds();</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">        if (nTime - pnode-&gt;nTimeConnected &gt; 60)</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">        {</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">        if (pnode-&gt;nLastRecv == 0 || pnode-&gt;nLastSend == 0)</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">        {</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">        LogPrint(BCLog::NET, &quot;socket no message in first 60 seconds, %d %d from %d\n&quot;, pnode-&gt;nLastRecv != 0, pnode-&gt;nLastSend != 0, pnode-&gt;GetId());</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">        pnode-&gt;fDisconnect = true;</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">        else if (nTime - pnode-&gt;nLastSend &gt; TIMEOUT_INTERVAL)</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">        {</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">        LogPrintf(&quot;socket sending timeout: %is\n&quot;, nTime - pnode-&gt;nLastSend);</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">        pnode-&gt;fDisconnect = true;</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">        else if (nTime - pnode-&gt;nLastRecv &gt; (pnode-&gt;nVersion &gt; BIP0031_VERSION ? TIMEOUT_INTERVAL : 90 * 60))</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">        {</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">        LogPrintf(&quot;socket receive timeout: %is\n&quot;, nTime - pnode-&gt;nLastRecv);</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">        pnode-&gt;fDisconnect = true;</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">        else if (pnode-&gt;nPingNonceSent &amp;&amp; pnode-&gt;nPingUsecStart + TIMEOUT_INTERVAL * 1000000 &lt; GetTimeMicros())</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">        {</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">        LogPrintf(&quot;ping timeout: %fs\n&quot;, 0.000001 * (GetTimeMicros() - pnode-&gt;nPingUsecStart));</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">        pnode-&gt;fDisconnect = true;</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">        else if (!pnode-&gt;fSuccessfullyConnected)</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">        {</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">        LogPrintf(&quot;version handshake timeout from %d\n&quot;, pnode-&gt;GetId());</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">        pnode-&gt;fDisconnect = true;</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">        }*/</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;}</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="class_network_manager.html#a68c600feeef71671d133c88c7c32da4a">  545</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#a68c600feeef71671d133c88c7c32da4a">NetworkManager::WakeMessageHandler</a>()</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;{</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        boost::lock_guard&lt;boost::mutex&gt; lock(<a class="code" href="class_network_manager.html#abae29b81b32efa712838f52f8aabf236">m_mutexMsgProc</a>);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <a class="code" href="class_network_manager.html#a7509c0b86351780fd092cf433f9795e6">m_bfMsgProcWake</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <a class="code" href="class_network_manager.html#a945f6ba4bcd6ce2c53220738f9640122">m_condMsgProc</a>.notify_one();</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="class_network_manager.html#a7838157f0e49e77f015a9326c23746b1">  554</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#a7838157f0e49e77f015a9326c23746b1">NetworkManager::ThreadOpenConnections</a>()</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;{</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">// run this loop until we interrupt it</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>)</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    {</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="comment">// is the network up and running</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="class_network_manager.html#ab6e9b8711788bbfb340738ff92b302be">m_bActiveNetwork</a>)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="comment">// sleep for 500 ms</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>.<a class="code" href="class_c_thread_interrupt.html#a6118393076e75866a688bb64ef4a1e63">sleep_for</a>(std::chrono::milliseconds(500)))</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="comment">// get the semaphore grant</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <a class="code" href="classc_semaphore_grant.html">cSemaphoreGrant</a> grant(*<a class="code" href="class_network_manager.html#a5ed61b32dd67cce5b0d03d017d380484">m_pSemOutbound</a>);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        </div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="comment">// get the first one in the list which is not connected</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        std::list&lt;netPeers&gt;::iterator itPeer = <a class="code" href="class_network_manager.html#a4da105c858ea073006e18d60cdadd300">getNextOutNode</a>(<span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="keywordflow">if</span> (itPeer == <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.end())</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="comment">// try to connect</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">if</span> (itPeer-&gt;tryConnectOutbound())</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="comment">// connection successfull move the semaphore</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <span class="keywordflow">if</span> (grant)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                grant.<a class="code" href="classc_semaphore_grant.html#a21a3839adddb64863b2125238659dbd9">MoveTo</a>(itPeer-&gt;semaphoreGrant);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="comment">// the connection was not successfull, check if we&#39;re already above our possible tries - if so we remove him</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <span class="keywordflow">if</span> (itPeer-&gt;tooManyTriesOutbound())</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;removing node due to too many connection errors - &quot;</span> + itPeer-&gt;toString(), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                {</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                    <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="class_network_manager.html#a75a0ee3afcd4d25adb9ff6bbb323b35c">m_csPeerListOut</a>);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                    <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.erase(itPeer);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    }</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;}</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div><div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="class_network_manager.html#af5e6b64265dc0147775f524a01e6d6f1">  599</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#af5e6b64265dc0147775f524a01e6d6f1">NetworkManager::ThreadMessageHandler</a>()</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;{</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="class_network_manager.html#ad519fe4c3fef08ebc88324a53a0ceea8">m_abflagInterruptMsgProc</a>)</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    {</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordtype">bool</span> fMoreWork = <span class="keyword">false</span>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="comment">// work those messages</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <a class="code" href="class_network_manager.html#a278ce13b8d97b651bafcdd1835e08b16">handleMessage</a>(&amp;<a class="code" href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">m_lstPeerListIn</a>, &amp;<a class="code" href="class_network_manager.html#a405f2efdf4f337703c2a0f1de03868ae">m_csPeerListIn</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <a class="code" href="class_network_manager.html#a278ce13b8d97b651bafcdd1835e08b16">handleMessage</a>(&amp;<a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>, &amp;<a class="code" href="class_network_manager.html#a75a0ee3afcd4d25adb9ff6bbb323b35c">m_csPeerListOut</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        boost::unique_lock&lt;boost::mutex&gt; lock(<a class="code" href="class_network_manager.html#abae29b81b32efa712838f52f8aabf236">m_mutexMsgProc</a>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">if</span> (!fMoreWork)</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <a class="code" href="class_network_manager.html#a945f6ba4bcd6ce2c53220738f9640122">m_condMsgProc</a>.wait_until(lock, boost::chrono::steady_clock::now() + boost::chrono::milliseconds(100), [<span class="keyword">this</span>] { <span class="keywordflow">return</span> <a class="code" href="class_network_manager.html#a7509c0b86351780fd092cf433f9795e6">m_bfMsgProcWake</a>; });</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <a class="code" href="class_network_manager.html#a7509c0b86351780fd092cf433f9795e6">m_bfMsgProcWake</a> = <span class="keyword">false</span>;        </div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;}</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno"><a class="line" href="class_network_manager.html#a278ce13b8d97b651bafcdd1835e08b16">  617</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#a278ce13b8d97b651bafcdd1835e08b16">NetworkManager::handleMessage</a>(<a class="code" href="classip_container.html">ipContainer&lt; netPeers&gt;</a> *peers, <a class="code" href="classc_critical_section.html">cCriticalSection</a> *<a class="code" href="namespace_m_c_p39_1_1language.html#a25b18d0c40153e6617136bc2e63b49e7">cs</a>, <span class="keywordtype">bool</span> bInbound)</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;{</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(cs);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">for</span> (std::list&lt; netPeers &gt;::iterator <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> = peers-&gt;<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.begin(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> != peers-&gt;<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.end(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>++)</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;mark();</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;toDestroy() || !<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hasMessage())</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="comment">// process received messages</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;hasMessage())</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <a class="code" href="classnet_message.html">netMessage</a> cpy;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="comment">// we make a temporary copy of the message so that we can release the lock faster in order to not block other threads</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;pcsvQueue);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                cpy = <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;getMessage();</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;popMessage();</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="class_network_manager.html#a88daa7015845740fa1fb510fc9b04e11">ProcessMessage</a>(cpy, <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>, bInbound))</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;Error processing message - disconnecting peer &quot;</span> + <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;toString(), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;markDestroy();</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            }</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        }</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;unmark();</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#ad519fe4c3fef08ebc88324a53a0ceea8">m_abflagInterruptMsgProc</a>)</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;}</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno"><a class="line" href="class_network_manager.html#a88daa7015845740fa1fb510fc9b04e11">  654</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_network_manager.html#a88daa7015845740fa1fb510fc9b04e11">NetworkManager::ProcessMessage</a>(<a class="code" href="classnet_message.html">netMessage</a> msg, std::list&lt; netPeers &gt;::iterator peer, <span class="keywordtype">bool</span> bInbound)</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;{</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="comment">// security check: when we receive a package that is not NET_VERSION in subject and validConnection() == false, it means we didnt receive the version string and the connection is possibly malicious. </span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="comment">// we skip all messages and destroy the connection for security reasons</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">if</span> (!peer-&gt;validConnection() &amp;&amp; (msg.<a class="code" href="classnet_message.html#aa53484d71941808fe5f24e9a2e82ef92">getHeader</a>().<a class="code" href="structs_header.html#a4ad712cc4957b459242b9c2f585b276e">ui16tSubject</a> != netMessage::SUBJECT::NET_VERSION))</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    {</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;Received a different package than NET_VERSION in the first communication. Destroying connection for security reasons!&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">switch</span> (msg.<a class="code" href="classnet_message.html#aa53484d71941808fe5f24e9a2e82ef92">getHeader</a>().<a class="code" href="structs_header.html#a4ad712cc4957b459242b9c2f585b276e">ui16tSubject</a>)</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_VERSION:</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="comment">// if the connection is already valid, we don&#39;t care for the version number anymore</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            <span class="keywordflow">if</span> (peer-&gt;validConnection())</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            uint32_t uint32tReceivedVersion;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            memcpy(&amp;uint32tReceivedVersion, msg.<a class="code" href="classnet_message.html#afc70e17f053acb1135ae3f8784f474da">getData</a>(), 4);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="preprocessor">    #ifdef _DEBUG</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <a class="code" href="logger_8h.html#ae1641999093a47ba019589c5dad08770">LOG_DEBUG</a>(<span class="stringliteral">&quot;Got Version Info from &quot;</span> + peer-&gt;toString() + <span class="stringliteral">&quot; - Version: &quot;</span> + std::to_string(uint32tReceivedVersion), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="comment">// if the connected client has an older version than ours, we inform him about a new version and then destroy the connection</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#a04c0a9ba8228218f9a3de694ce624e8a">g_cuint32tVersion</a> &gt; uint32tReceivedVersion)</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            {</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                {</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                    <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(peer-&gt;pcsvSend);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                    peer-&gt;listSend.emplace_back(netMessage::SUBJECT::NET_VERSION_NEWER, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="defines_8h.html#a04c0a9ba8228218f9a3de694ce624e8a">g_cuint32tVersion</a>, <span class="keyword">sizeof</span>(g_cuint32tVersion), <span class="keyword">true</span>);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;Connected client has a lower version than ours, inform and disconnect - &quot;</span> + peer-&gt;toString(), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            <span class="comment">// if the connected client is newer than ours, we increment a ticker in the metachain and also destroy this connection</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#a04c0a9ba8228218f9a3de694ce624e8a">g_cuint32tVersion</a> &lt; uint32tReceivedVersion)</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                <a class="code" href="class_meta_chain.html#a9c97062a7a5fc71592e9bdcf4a07d3ba">MetaChain::getInstance</a>().<a class="code" href="class_meta_chain.html#a40346e4a086fda36f926daa11259d46f">incrementNewerVersionTicker</a>();</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;We have an older version than the connected client, increment the version ticker and disconnect - &quot;</span> + peer-&gt;toString(), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <span class="comment">// wenn the version number is the same, we don&#39;t do anything except we set a flag that the initial communication was made and the peer is ready for full service, as well as we ask them to send us their peer list</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                <span class="comment">// the connection is now valid</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                peer-&gt;validConnection(<span class="keyword">true</span>);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(peer-&gt;pcsvSend);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                <span class="keywordtype">bool</span> bTmp;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                peer-&gt;listSend.emplace_back(netMessage::SUBJECT::NET_VERSION, (<span class="keywordtype">void</span> *)&amp;<a class="code" href="defines_8h.html#a04c0a9ba8228218f9a3de694ce624e8a">g_cuint32tVersion</a>, <span class="keyword">sizeof</span>(g_cuint32tVersion), <span class="keyword">true</span>);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                bTmp = <a class="code" href="class_meta_chain.html#a9c97062a7a5fc71592e9bdcf4a07d3ba">MetaChain::getInstance</a>().<a class="code" href="class_meta_chain.html#a4631a8e5ac66d05bb8c688900e2eb1d7">isTestNet</a>();</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                peer-&gt;listSend.emplace_back(netMessage::SUBJECT::NET_TESTNET, (<span class="keywordtype">void</span> *)&amp;bTmp, <span class="keyword">sizeof</span>(<span class="keywordtype">bool</span>), <span class="keyword">true</span>);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                bTmp = <a class="code" href="class_meta_chain.html#a9c97062a7a5fc71592e9bdcf4a07d3ba">MetaChain::getInstance</a>().<a class="code" href="class_meta_chain.html#a421a4eede44c6a594e6ea406f0d506a4">isFN</a>();</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                peer-&gt;listSend.emplace_back(netMessage::SUBJECT::NET_NODEMODE, (<span class="keywordtype">void</span> *)&amp;bTmp, <span class="keyword">sizeof</span>(<span class="keywordtype">bool</span>), <span class="keyword">true</span>);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            }</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        }</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_NODEMODE:</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="comment">// store the nodemode info for this peer. This is the last step in our handshake before the actual blockchain communication and that&#39;s why we request the peers from our partner now</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            <span class="keywordtype">bool</span> bFN = <span class="keyword">false</span>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            memcpy(&amp;bFN, msg.<a class="code" href="classnet_message.html#afc70e17f053acb1135ae3f8784f474da">getData</a>(), <span class="keyword">sizeof</span>(bool));</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            peer-&gt;setNodeMode(bFN);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                    </div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(peer-&gt;pcsvSend);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="comment">// if it&#39;s a full node, we want to know his listening port so that we can forward this information to all other connecting peers</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">if</span> (bFN)</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                peer-&gt;listSend.emplace_back(netMessage::SUBJECT::NET_NODE_LISTENING_PORT_GET, (<span class="keywordtype">void</span>*)NULL, 0, <span class="keyword">true</span>);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <span class="comment">// request peers</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            peer-&gt;listSend.emplace_back(netMessage::SUBJECT::NET_PEER_LIST_SEND, (<span class="keywordtype">void</span>*)NULL, 0, <span class="keyword">true</span>);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_NODE_LISTENING_PORT_GET:</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(peer-&gt;pcsvSend);</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <span class="comment">// send back our listening port from our socket.</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> usTmp = <a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a>-&gt;<a class="code" href="class_c_service.html#a71caa0d6aa6ab12758bde8b6a6bcfd2a">GetPort</a>();</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            peer-&gt;listSend.emplace_back(netMessage::SUBJECT::NET_NODE_LISTENING_PORT_SEND, (<span class="keywordtype">void</span>*)&amp;usTmp, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>), <span class="keyword">true</span>);</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_NODE_LISTENING_PORT_SEND:</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        {</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="comment">// we get the listening port when the connected peer is a FN so that when the connection was incoming, we can forward the real port for the FN in our NET_PEER_LIST_SEND</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> usListeningPort;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            memcpy(&amp;usListeningPort, msg.<a class="code" href="classnet_message.html#afc70e17f053acb1135ae3f8784f474da">getData</a>(), <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> short));</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            peer-&gt;setListeningPort(usListeningPort);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        }</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_TESTNET:</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="comment">// we compare if the new connection is in the testnet or not and if that&#39;s the same as our node. if not, we remove the connection</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <span class="keywordtype">bool</span> bTestNet = <span class="keyword">false</span>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            memcpy(&amp;bTestNet, msg.<a class="code" href="classnet_message.html#afc70e17f053acb1135ae3f8784f474da">getData</a>(), <span class="keyword">sizeof</span>(bool));</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_meta_chain.html#a9c97062a7a5fc71592e9bdcf4a07d3ba">MetaChain::getInstance</a>().isTestNet() != bTestNet)</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;removing peer due to incompability with testnet&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        }</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_VERSION_NEWER:</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;new version info received&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="comment">// it looks like we have an older version than the connected node. We increment our ticker for future checking of newer versions</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <a class="code" href="class_meta_chain.html#a9c97062a7a5fc71592e9bdcf4a07d3ba">MetaChain::getInstance</a>().<a class="code" href="class_meta_chain.html#a40346e4a086fda36f926daa11259d46f">incrementNewerVersionTicker</a>();</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="comment">// we dont need to disconnect the node since after this Message the node will automatically disconnect</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_PEER_LIST_SEND:</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <span class="keywordtype">int</span> iNumOfPeers = 0;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiCount = 0;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            uint8_t *puint8tBuffer;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <span class="comment">// 18: ipv4 needs *4, ipv6 needs *16. So we use *16 for the IP and then *2 for the port</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> susIpPortSize = 18;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="class_network_manager.html#a75a0ee3afcd4d25adb9ff6bbb323b35c">m_csPeerListOut</a>);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="class_network_manager.html#a405f2efdf4f337703c2a0f1de03868ae">m_csPeerListIn</a>);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                <span class="comment">// the connected node wants to know our peers for their reference. we build up some data, excluding the requesting peer itself and sending it over for them to process</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                iNumOfPeers = <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.size() + <a class="code" href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">m_lstPeerListIn</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.size() - 1;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                <span class="comment">// if we don&#39;t have any peers, we simply quit this operation without sending anything</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                <span class="keywordflow">if</span> (iNumOfPeers == 0)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                <span class="comment">// make us a buffer array. we multiply the number of peers by 18: ipv4 needs *4, ipv6 needs *16. So we use *16 for the IP and then *2 for the port          </span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                puint8tBuffer = <span class="keyword">new</span> uint8_t[iNumOfPeers * susIpPortSize];</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                memset(puint8tBuffer, <span class="charliteral">&#39;\0&#39;</span>, iNumOfPeers * susIpPortSize);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                <span class="comment">// now copy it into the buffer and skip all non full nodes</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                <span class="keywordflow">for</span> (std::list&lt;netPeers&gt;::iterator <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> = <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.begin(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> != <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.end(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>++)</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                {</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    <span class="keywordflow">if</span>( (bInbound || <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> != peer) &amp;&amp; (peer-&gt;isFN()) )</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                    {</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                        <span class="comment">// copy the ip adress                   </span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                        memcpy((puint8tBuffer + uiCount * <span class="keyword">sizeof</span>(uint8_t) * susIpPortSize), <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;csAddress.GetBytes(), <span class="keyword">sizeof</span>(uint8_t) * 16);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                        <span class="comment">// copy the port</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                        uint16_t port = <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;getListeningPort();</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                        memcpy((puint8tBuffer + uiCount * <span class="keyword">sizeof</span>(uint8_t) * susIpPortSize + susIpPortSize - 2 * <span class="keyword">sizeof</span>(uint8_t)), &amp;port, <span class="keyword">sizeof</span>(port));</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                        uiCount++;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                    }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                }</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                <span class="keywordflow">for</span> (std::list&lt;netPeers&gt;::iterator <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> = <a class="code" href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">m_lstPeerListIn</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.begin(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> != <a class="code" href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">m_lstPeerListIn</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.end(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>++)</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                    <span class="keywordflow">if</span> ( (!bInbound || <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> != peer) &amp;&amp; (peer-&gt;isFN()) )</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                    {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                        <span class="comment">// copy the ip adress                   </span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                        memcpy((puint8tBuffer + uiCount * <span class="keyword">sizeof</span>(uint8_t) * susIpPortSize), <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;csAddress.GetBytes(), <span class="keyword">sizeof</span>(uint8_t) * 16);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                        <span class="comment">// copy the port</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                        uint16_t port = <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;getListeningPort();</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                        memcpy((puint8tBuffer + uiCount * <span class="keyword">sizeof</span>(uint8_t) * susIpPortSize + susIpPortSize - 2 * <span class="keyword">sizeof</span>(uint8_t)), &amp;port, <span class="keyword">sizeof</span>(port));</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                        uiCount++;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                    }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                }</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            }</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            <span class="comment">// and finally we sent our peer list on the way</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(peer-&gt;pcsvSend);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            peer-&gt;listSend.emplace_back(netMessage::SUBJECT::NET_PEER_LIST_GET, (<span class="keywordtype">void</span> *)puint8tBuffer, uiCount * susIpPortSize, <span class="keyword">true</span>);</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            <span class="keyword">delete</span>[] puint8tBuffer;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        }</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_PEER_LIST_GET:</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            <span class="comment">// make us a buffer array. the size of the buffer is defined by the payload and we can calculate backwards to the number of peers</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> susIpPortSize = 18;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            <span class="keywordtype">int</span> iNumOfPeers = msg.<a class="code" href="classnet_message.html#aa53484d71941808fe5f24e9a2e82ef92">getHeader</a>().<a class="code" href="structs_header.html#a14d4cc5c72ce487709389831e030378a">ui32tPayloadSize</a> / susIpPortSize;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="comment">// get the individual peers, create the adress and add it to our outgoing list</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; iNumOfPeers; i++)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                uint16_t port = 0;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                uint8_t *puint8tBuffer = <span class="keyword">new</span> uint8_t[susIpPortSize];</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                memcpy(puint8tBuffer, msg.<a class="code" href="classnet_message.html#afc70e17f053acb1135ae3f8784f474da">getData</a>() + i*susIpPortSize, susIpPortSize);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                memcpy(&amp;port, puint8tBuffer + (susIpPortSize - <span class="keyword">sizeof</span>(uint16_t)), <span class="keyword">sizeof</span>(uint16_t));</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                <a class="code" href="classnet_peers.html">netPeers</a> tmp;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                tmp.<a class="code" href="classnet_peers.html#a2984e69e23bc63aabeede92b07d8639e">csAddress</a>.<a class="code" href="class_c_net_addr.html#a1f0b23aca4ca78c11735d13f3583b7ad">SetRaw</a>(puint8tBuffer);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                tmp.<a class="code" href="classnet_peers.html#a2984e69e23bc63aabeede92b07d8639e">csAddress</a>.<a class="code" href="class_c_service.html#a3dedc3f12aa21bdbf1068b054d3e3d39">SetPort</a>(port);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                <a class="code" href="class_c_net_addr.html">CNetAddr</a> addr = tmp.<a class="code" href="classnet_peers.html#a2984e69e23bc63aabeede92b07d8639e">csAddress</a>;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="preprocessor">    #ifndef _DEBUG</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                <span class="comment">// when we&#39;re in production mode we don&#39;t accept new nodes that are on a local interface. it makes no sense to run multiple nodes on a single system</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                <span class="keywordflow">if</span> (addr.<a class="code" href="class_c_net_addr.html#a857bfcf95814b7d6ef4db309c84f179d">IsLocal</a>())</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="preprocessor">    #endif </span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                <span class="comment">// check if it&#39;s me</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                <span class="keywordflow">if</span> (*<a class="code" href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">m_pServiceLocal</a> == addr)</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                {</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="preprocessor">    #ifdef _DEBUG</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                    <a class="code" href="logger_8h.html#ae1641999093a47ba019589c5dad08770">LOG_DEBUG</a>(<span class="stringliteral">&quot;Not adding new Peer since it&#39;s me!&quot;</span>, <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                }</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <span class="comment">// check if we have this node already in our list</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                    <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="class_network_manager.html#a75a0ee3afcd4d25adb9ff6bbb323b35c">m_csPeerListOut</a>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#a47bfd57a878ecad468b8f26dc6224d03">m_lstBanList</a>.<a class="code" href="classip_container.html#adbfd3103fc17563d8d2b4d17c351902a">entryExists</a>(&amp;addr))</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                        <a class="code" href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a>(<span class="stringliteral">&quot;Not adding new outbound peer - peer is banned - &quot;</span> + tmp.<a class="code" href="classnet_peers.html#a11ba7334d520efd46d8329ae1e4b9cf9">toString</a>(), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#adbfd3103fc17563d8d2b4d17c351902a">entryExists</a>(&amp;tmp) )</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                    {</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                        <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.push_back(tmp);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                        <a class="code" href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a>(<span class="stringliteral">&quot;Adding new outbound peer - &quot;</span> + tmp.<a class="code" href="classnet_peers.html#a11ba7334d520efd46d8329ae1e4b9cf9">toString</a>(), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                    }</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="preprocessor">    #ifdef _DEBUG</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                        <a class="code" href="logger_8h.html#ae1641999093a47ba019589c5dad08770">LOG_DEBUG</a>(<span class="stringliteral">&quot;Not adding new Peer since it&#39;s already known - &quot;</span> + tmp.<a class="code" href="classnet_peers.html#a11ba7334d520efd46d8329ae1e4b9cf9">toString</a>(), <span class="stringliteral">&quot;NET&quot;</span>);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                }</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                <span class="keyword">delete</span>[] puint8tBuffer;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            }   </div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        }</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">// the default statement as well as the ban list statements. We don&#39;t support sending ban lists, everyone has to build them theirselfs right now</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_BAN_LIST_GET:</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">case</span> netMessage::SUBJECT::NET_BAN_LIST_SEND:</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    }</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;}</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno"><a class="line" href="class_network_manager.html#a4da105c858ea073006e18d60cdadd300">  901</a></span>&#160;std::list&lt; netPeers &gt;::iterator <a class="code" href="class_network_manager.html#a4da105c858ea073006e18d60cdadd300">NetworkManager::getNextOutNode</a>(<span class="keywordtype">bool</span> bConnected, <span class="keywordtype">bool</span> bCheckTimeDelta)</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;{</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="class_network_manager.html#a75a0ee3afcd4d25adb9ff6bbb323b35c">m_csPeerListOut</a>);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">for</span> (std::list&lt; netPeers &gt;::iterator <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> = <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.begin(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a> != <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.end(); <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>++ )</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;isConnected() != bConnected)</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordflow">if</span> (bCheckTimeDelta &amp;&amp; (<a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;getTimeLastTry() != 0) &amp;&amp; (<a class="code" href="functions_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a>() - <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>-&gt;getTimeLastTry() &lt;= <a class="code" href="class_network_manager.html#a4a585d43b4a2ac8916a615c6c472f6d7">m_iTimeBetweenConnects</a>))</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">it</a>;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    }</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a12cf39912931985fa786f3faf299bbef">lstIP</a>.end();</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;}</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno"><a class="line" href="class_network_manager.html#ad19c25f249c8f7e21436fdd0914c5635">  918</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#ad19c25f249c8f7e21436fdd0914c5635">NetworkManager::DumpData</a>()</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;{</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="comment">// write the ban list</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <a class="code" href="class_network_manager.html#a47bfd57a878ecad468b8f26dc6224d03">m_lstBanList</a>.<a class="code" href="classip_container.html#a6b77e4dd4e9681f1a8aa1da7c997ce07">writeContents</a>();</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="comment">// write the Peer List Out</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="class_network_manager.html#a75a0ee3afcd4d25adb9ff6bbb323b35c">m_csPeerListOut</a>);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <a class="code" href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a>(<a class="code" href="class_network_manager.html#a405f2efdf4f337703c2a0f1de03868ae">m_csPeerListIn</a>);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <a class="code" href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">m_lstPeerListOut</a>.<a class="code" href="classip_container.html#a6b77e4dd4e9681f1a8aa1da7c997ce07">writeContents</a>();</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <a class="code" href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">m_lstPeerListIn</a>.<a class="code" href="classip_container.html#a6b77e4dd4e9681f1a8aa1da7c997ce07">writeContents</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;}</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno"><a class="line" href="class_network_manager.html#a2cfe4223139cf58587a9f066b956cb23">  930</a></span>&#160;<a class="code" href="class_network_manager.html#a2cfe4223139cf58587a9f066b956cb23">NetworkManager::~NetworkManager</a>()</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;{</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="comment">// stop and delete the threads</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <a class="code" href="class_network_manager.html#a26c646f9943d9ddc87e91104ce850b0c">Interrupt</a>();</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <a class="code" href="class_network_manager.html#ac585f836f81265b24c9fac58e8563055">Stop</a>();</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="comment">// dump the data one last time</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <a class="code" href="class_network_manager.html#ad19c25f249c8f7e21436fdd0914c5635">DumpData</a>();</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;}</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno"><a class="line" href="class_network_manager.html#a26c646f9943d9ddc87e91104ce850b0c">  940</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#a26c646f9943d9ddc87e91104ce850b0c">NetworkManager::Interrupt</a>()</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;{</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        boost::lock_guard&lt;boost::mutex&gt; lock(<a class="code" href="class_network_manager.html#abae29b81b32efa712838f52f8aabf236">m_mutexMsgProc</a>);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <a class="code" href="class_network_manager.html#ad519fe4c3fef08ebc88324a53a0ceea8">m_abflagInterruptMsgProc</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <a class="code" href="class_network_manager.html#a945f6ba4bcd6ce2c53220738f9640122">m_condMsgProc</a>.notify_all();</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <a class="code" href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">m_interruptNet</a>();</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;}</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno"><a class="line" href="class_network_manager.html#ac585f836f81265b24c9fac58e8563055">  951</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_network_manager.html#ac585f836f81265b24c9fac58e8563055">NetworkManager::Stop</a>()</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;{</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#a5c460478d30acee5d5bd9082b9eb40cb">threadMessageHandler</a>.joinable())</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <a class="code" href="class_network_manager.html#a5c460478d30acee5d5bd9082b9eb40cb">threadMessageHandler</a>.join();</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#a31005bfe5cde2c6e935c506ee881141d">threadOpenConnections</a>.joinable())</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <a class="code" href="class_network_manager.html#a31005bfe5cde2c6e935c506ee881141d">threadOpenConnections</a>.join();</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="class_network_manager.html#ad5d22fe6eb481e5998e8c455da540aba">threadSocketHandler</a>.joinable())</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <a class="code" href="class_network_manager.html#ad5d22fe6eb481e5998e8c455da540aba">threadSocketHandler</a>.join();</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;}</div><div class="ttc" id="class_network_manager_html_a68c600feeef71671d133c88c7c32da4a"><div class="ttname"><a href="class_network_manager.html#a68c600feeef71671d133c88c7c32da4a">NetworkManager::WakeMessageHandler</a></div><div class="ttdeci">void WakeMessageHandler()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00545">NetworkManager.cpp:545</a></div></div>
<div class="ttc" id="class_network_manager_html_a336caef94fed1e40fae5a1126029a5c4"><div class="ttname"><a href="class_network_manager.html#a336caef94fed1e40fae5a1126029a5c4">NetworkManager::handlePeers</a></div><div class="ttdeci">void handlePeers(ipContainer&lt; netPeers &gt; *peers, cCriticalSection *cs)</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00288">NetworkManager.cpp:288</a></div></div>
<div class="ttc" id="class_c_service_html_a71caa0d6aa6ab12758bde8b6a6bcfd2a"><div class="ttname"><a href="class_c_service.html#a71caa0d6aa6ab12758bde8b6a6bcfd2a">CService::GetPort</a></div><div class="ttdeci">unsigned short GetPort() const</div><div class="ttdef"><b>Definition:</b> <a href="_c_service_8cpp_source.html#l00060">CService.cpp:60</a></div></div>
<div class="ttc" id="functions_8cpp_html_aeb0961aecb19bbca063c3514b25b20c9"><div class="ttname"><a href="functions_8cpp.html#aeb0961aecb19bbca063c3514b25b20c9">CloseSocket</a></div><div class="ttdeci">bool CloseSocket(SOCKET &amp;hSocket)</div><div class="ttdef"><b>Definition:</b> <a href="functions_8cpp_source.html#l00129">functions.cpp:129</a></div></div>
<div class="ttc" id="class_c_thread_interrupt_html_a6118393076e75866a688bb64ef4a1e63"><div class="ttname"><a href="class_c_thread_interrupt.html#a6118393076e75866a688bb64ef4a1e63">CThreadInterrupt::sleep_for</a></div><div class="ttdeci">bool sleep_for(std::chrono::milliseconds rel_time)</div><div class="ttdef"><b>Definition:</b> <a href="c_thread_interrupt_8cpp_source.html#l00029">cThreadInterrupt.cpp:29</a></div></div>
<div class="ttc" id="class_network_manager_html_a624c2dc866adecafe6750ba74eae1a55"><div class="ttname"><a href="class_network_manager.html#a624c2dc866adecafe6750ba74eae1a55">NetworkManager::m_pServiceLocal</a></div><div class="ttdeci">CService * m_pServiceLocal</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00037">NetworkManager.h:37</a></div></div>
<div class="ttc" id="classnet_peers_html_a2984e69e23bc63aabeede92b07d8639e"><div class="ttname"><a href="classnet_peers.html#a2984e69e23bc63aabeede92b07d8639e">netPeers::csAddress</a></div><div class="ttdeci">CService csAddress</div><div class="ttdef"><b>Definition:</b> <a href="net_peers_8h_source.html#l00065">netPeers.h:65</a></div></div>
<div class="ttc" id="logger_8h_html_abaa28476630871d6cd028ba0d155a77f"><div class="ttname"><a href="logger_8h.html#abaa28476630871d6cd028ba0d155a77f">LOG</a></div><div class="ttdeci">#define LOG(logline, module)</div><div class="ttdef"><b>Definition:</b> <a href="logger_8h_source.html#l00063">logger.h:63</a></div></div>
<div class="ttc" id="namespace_m_c_p39_1_1language_html_a25b18d0c40153e6617136bc2e63b49e7"><div class="ttname"><a href="namespace_m_c_p39_1_1language.html#a25b18d0c40153e6617136bc2e63b49e7">MCP39::language::cs</a></div><div class="ttdeci">const dictionary cs</div><div class="ttdef"><b>Definition:</b> <a href="dictionairy_8cpp_source.html#l10277">dictionairy.cpp:10277</a></div></div>
<div class="ttc" id="class_c_net_addr_html_a857bfcf95814b7d6ef4db309c84f179d"><div class="ttname"><a href="class_c_net_addr.html#a857bfcf95814b7d6ef4db309c84f179d">CNetAddr::IsLocal</a></div><div class="ttdeci">bool IsLocal() const</div><div class="ttdef"><b>Definition:</b> <a href="_c_net_addr_8cpp_source.html#l00217">CNetAddr.cpp:217</a></div></div>
<div class="ttc" id="net_message_8h_html"><div class="ttname"><a href="net_message_8h.html">netMessage.h</a></div></div>
<div class="ttc" id="defines_8h_html_a7ce1c171e08d68442124bf6189f8aec5"><div class="ttname"><a href="defines_8h.html#a7ce1c171e08d68442124bf6189f8aec5">WSAEMSGSIZE</a></div><div class="ttdeci">#define WSAEMSGSIZE</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00050">defines.h:50</a></div></div>
<div class="ttc" id="class_c_simple_ini_templ_html_a74e3f5d22f50b70b2a20c89ec7e2c737"><div class="ttname"><a href="class_c_simple_ini_templ.html#a74e3f5d22f50b70b2a20c89ec7e2c737">CSimpleIniTempl::GetValue</a></div><div class="ttdeci">const SI_CHAR * GetValue(const SI_CHAR *a_pSection, const SI_CHAR *a_pKey, const SI_CHAR *a_pDefault=NULL, bool *a_pHasMultiple=NULL) const</div><div class="ttdef"><b>Definition:</b> <a href="_simple_ini_8h_source.html#l01981">SimpleIni.h:1981</a></div></div>
<div class="ttc" id="tinyformat_8h_html_a56c674871a61baaad36ad52238c08857"><div class="ttname"><a href="tinyformat_8h.html#a56c674871a61baaad36ad52238c08857">strprintf</a></div><div class="ttdeci">#define strprintf</div><div class="ttdef"><b>Definition:</b> <a href="tinyformat_8h_source.html#l01051">tinyformat.h:1051</a></div></div>
<div class="ttc" id="class_network_manager_html_a118413bb02740da31598bca051b3e98b"><div class="ttname"><a href="class_network_manager.html#a118413bb02740da31598bca051b3e98b">NetworkManager::NetworkManager</a></div><div class="ttdeci">NetworkManager(MetaChain *mc)</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00027">NetworkManager.cpp:27</a></div></div>
<div class="ttc" id="class_c_simple_ini_templ_html"><div class="ttname"><a href="class_c_simple_ini_templ.html">CSimpleIniTempl</a></div><div class="ttdef"><b>Definition:</b> <a href="_simple_ini_8h_source.html#l00295">SimpleIni.h:295</a></div></div>
<div class="ttc" id="class_network_manager_html_a9514edceb8d142c01724322d36f42062"><div class="ttname"><a href="class_network_manager.html#a9514edceb8d142c01724322d36f42062">NetworkManager::m_iMaxInboundConnections</a></div><div class="ttdeci">int m_iMaxInboundConnections</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00041">NetworkManager.h:41</a></div></div>
<div class="ttc" id="classnet_peers_html_a11ba7334d520efd46d8329ae1e4b9cf9"><div class="ttname"><a href="classnet_peers.html#a11ba7334d520efd46d8329ae1e4b9cf9">netPeers::toString</a></div><div class="ttdeci">std::string toString()</div><div class="ttdef"><b>Definition:</b> <a href="net_peers_8cpp_source.html#l00341">netPeers.cpp:341</a></div></div>
<div class="ttc" id="class_network_manager_html_a4a585d43b4a2ac8916a615c6c472f6d7"><div class="ttname"><a href="class_network_manager.html#a4a585d43b4a2ac8916a615c6c472f6d7">NetworkManager::m_iTimeBetweenConnects</a></div><div class="ttdeci">int m_iTimeBetweenConnects</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00039">NetworkManager.h:39</a></div></div>
<div class="ttc" id="functions_8cpp_html_a6c44614cb5f9293d8419248a0b72d4b0"><div class="ttname"><a href="functions_8cpp.html#a6c44614cb5f9293d8419248a0b72d4b0">SetSocketNonBlocking</a></div><div class="ttdeci">bool SetSocketNonBlocking(SOCKET &amp;hSocket, bool fNonBlocking)</div><div class="ttdef"><b>Definition:</b> <a href="functions_8cpp_source.html#l00095">functions.cpp:95</a></div></div>
<div class="ttc" id="class_c_net_addr_html_aad5f7a372c56ccf4d773f728b6b46e18"><div class="ttname"><a href="class_c_net_addr.html#aad5f7a372c56ccf4d773f728b6b46e18">CNetAddr::IsIPv6</a></div><div class="ttdeci">bool IsIPv6() const</div><div class="ttdef"><b>Definition:</b> <a href="_c_net_addr_8cpp_source.html#l00139">CNetAddr.cpp:139</a></div></div>
<div class="ttc" id="class_network_manager_html_af06f1b25c87391d423a243f1bd2cbc3d"><div class="ttname"><a href="class_network_manager.html#af06f1b25c87391d423a243f1bd2cbc3d">NetworkManager::initialize</a></div><div class="ttdeci">bool initialize(CSimpleIniA *iniFile)</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00042">NetworkManager.cpp:42</a></div></div>
<div class="ttc" id="class_network_manager_html_af7326c9d0cefa365670eb3f9ec6d0e27"><div class="ttname"><a href="class_network_manager.html#af7326c9d0cefa365670eb3f9ec6d0e27">NetworkManager::startThreads</a></div><div class="ttdeci">void startThreads()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00200">NetworkManager.cpp:200</a></div></div>
<div class="ttc" id="defines_8h_html_af1ec4e1407f8eabfb9ac1fbf113f9cac"><div class="ttname"><a href="defines_8h.html#af1ec4e1407f8eabfb9ac1fbf113f9cac">NET_STANDARD_PORT_LISTENING</a></div><div class="ttdeci">#define NET_STANDARD_PORT_LISTENING</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00060">defines.h:60</a></div></div>
<div class="ttc" id="class_meta_chain_html_a4631a8e5ac66d05bb8c688900e2eb1d7"><div class="ttname"><a href="class_meta_chain.html#a4631a8e5ac66d05bb8c688900e2eb1d7">MetaChain::isTestNet</a></div><div class="ttdeci">bool isTestNet()</div><div class="ttdef"><b>Definition:</b> <a href="_meta_chain_8h_source.html#l00077">MetaChain.h:77</a></div></div>
<div class="ttc" id="class_meta_chain_html_afb2672d138af6a985e9279db39029bc7"><div class="ttname"><a href="class_meta_chain.html#afb2672d138af6a985e9279db39029bc7">MetaChain::getScheduler</a></div><div class="ttdeci">CScheduler * getScheduler()</div><div class="ttdef"><b>Definition:</b> <a href="_meta_chain_8h_source.html#l00072">MetaChain.h:72</a></div></div>
<div class="ttc" id="classnet_peers_html_a4414640b4daa656cae91bf93f5e25517"><div class="ttname"><a href="classnet_peers.html#a4414640b4daa656cae91bf93f5e25517">netPeers::pcsvSend</a></div><div class="ttdeci">cCriticalSection * pcsvSend</div><div class="ttdef"><b>Definition:</b> <a href="net_peers_8h_source.html#l00080">netPeers.h:80</a></div></div>
<div class="ttc" id="class_network_manager_html_a4da105c858ea073006e18d60cdadd300"><div class="ttname"><a href="class_network_manager.html#a4da105c858ea073006e18d60cdadd300">NetworkManager::getNextOutNode</a></div><div class="ttdeci">std::list&lt; netPeers &gt;::iterator getNextOutNode(bool bConnected=true, bool bCheckTimeDelta=true)</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00901">NetworkManager.cpp:901</a></div></div>
<div class="ttc" id="class_network_manager_html_a31005bfe5cde2c6e935c506ee881141d"><div class="ttname"><a href="class_network_manager.html#a31005bfe5cde2c6e935c506ee881141d">NetworkManager::threadOpenConnections</a></div><div class="ttdeci">std::thread threadOpenConnections</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00058">NetworkManager.h:58</a></div></div>
<div class="ttc" id="defines_8h_html_a9f55d0e90dc8cc6b2287312435cdde48"><div class="ttname"><a href="defines_8h.html#a9f55d0e90dc8cc6b2287312435cdde48">MSG_NOSIGNAL</a></div><div class="ttdeci">#define MSG_NOSIGNAL</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00094">defines.h:94</a></div></div>
<div class="ttc" id="defines_8h_html_ada8711ffab59910a2732cfa4b7c24e29"><div class="ttname"><a href="defines_8h.html#ada8711ffab59910a2732cfa4b7c24e29">WSAEINPROGRESS</a></div><div class="ttdeci">#define WSAEINPROGRESS</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00052">defines.h:52</a></div></div>
<div class="ttc" id="c_critical_section_8h_html_a911fe23f057c2fe5aad629162d6c99d0"><div class="ttname"><a href="c_critical_section_8h.html#a911fe23f057c2fe5aad629162d6c99d0">LOCK</a></div><div class="ttdeci">#define LOCK(cs)</div><div class="ttdef"><b>Definition:</b> <a href="c_critical_section_8h_source.html#l00174">cCriticalSection.h:174</a></div></div>
<div class="ttc" id="class_c_service_html_a3dedc3f12aa21bdbf1068b054d3e3d39"><div class="ttname"><a href="class_c_service.html#a3dedc3f12aa21bdbf1068b054d3e3d39">CService::SetPort</a></div><div class="ttdeci">void SetPort(unsigned short portIn)</div><div class="ttdef"><b>Definition:</b> <a href="_c_service_8cpp_source.html#l00140">CService.cpp:140</a></div></div>
<div class="ttc" id="classnet_peers_html_ac3c5825cf4947b284f22c1e6eccfcab5"><div class="ttname"><a href="classnet_peers.html#ac3c5825cf4947b284f22c1e6eccfcab5">netPeers::unmark</a></div><div class="ttdeci">void unmark()</div><div class="ttdef"><b>Definition:</b> <a href="net_peers_8h_source.html#l00090">netPeers.h:90</a></div></div>
<div class="ttc" id="class_c_scheduler_html_aab114cb7085474e0f1a47aa2b54e9cae"><div class="ttname"><a href="class_c_scheduler.html#aab114cb7085474e0f1a47aa2b54e9cae">CScheduler::scheduleEvery</a></div><div class="ttdeci">void scheduleEvery(Function f, int64_t deltaMilliSeconds)</div><div class="ttdef"><b>Definition:</b> <a href="scheduler_8cpp_source.html#l00123">scheduler.cpp:123</a></div></div>
<div class="ttc" id="class_network_manager_html_a2b4394d78dc3190662f1be29243a2fbe"><div class="ttname"><a href="class_network_manager.html#a2b4394d78dc3190662f1be29243a2fbe">NetworkManager::m_lstPeerListIn</a></div><div class="ttdeci">ipContainer&lt; netPeers &gt; m_lstPeerListIn</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00076">NetworkManager.h:76</a></div></div>
<div class="ttc" id="class_meta_chain_html_a9c97062a7a5fc71592e9bdcf4a07d3ba"><div class="ttname"><a href="class_meta_chain.html#a9c97062a7a5fc71592e9bdcf4a07d3ba">MetaChain::getInstance</a></div><div class="ttdeci">static MetaChain &amp; getInstance()</div><div class="ttdef"><b>Definition:</b> <a href="_meta_chain_8cpp_source.html#l00035">MetaChain.cpp:35</a></div></div>
<div class="ttc" id="functions_8cpp_html_a46fac5fba8ba905b5f9acb364f5d8c6f"><div class="ttname"><a href="functions_8cpp.html#a46fac5fba8ba905b5f9acb364f5d8c6f">GetTime</a></div><div class="ttdeci">int64_t GetTime()</div><div class="ttdef"><b>Definition:</b> <a href="functions_8cpp_source.html#l00157">functions.cpp:157</a></div></div>
<div class="ttc" id="class_network_manager_html_a945f6ba4bcd6ce2c53220738f9640122"><div class="ttname"><a href="class_network_manager.html#a945f6ba4bcd6ce2c53220738f9640122">NetworkManager::m_condMsgProc</a></div><div class="ttdeci">boost::condition_variable m_condMsgProc</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00048">NetworkManager.h:48</a></div></div>
<div class="ttc" id="defines_8h_html_aef81890a7d46cb9dda85df9b96cba6b1"><div class="ttname"><a href="defines_8h.html#aef81890a7d46cb9dda85df9b96cba6b1">WSAEINTR</a></div><div class="ttdeci">#define WSAEINTR</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00051">defines.h:51</a></div></div>
<div class="ttc" id="defines_8h_html_a04c0a9ba8228218f9a3de694ce624e8a"><div class="ttname"><a href="defines_8h.html#a04c0a9ba8228218f9a3de694ce624e8a">g_cuint32tVersion</a></div><div class="ttdeci">const uint32_t g_cuint32tVersion</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00013">defines.h:13</a></div></div>
<div class="ttc" id="class_network_manager_html_ad19c25f249c8f7e21436fdd0914c5635"><div class="ttname"><a href="class_network_manager.html#ad19c25f249c8f7e21436fdd0914c5635">NetworkManager::DumpData</a></div><div class="ttdeci">void DumpData()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00918">NetworkManager.cpp:918</a></div></div>
<div class="ttc" id="functions_8cpp_html_a8ddb7d8d6e5b5cfabfdeea132f556977"><div class="ttname"><a href="functions_8cpp.html#a8ddb7d8d6e5b5cfabfdeea132f556977">NetworkErrorString</a></div><div class="ttdeci">std::string NetworkErrorString(int err)</div><div class="ttdef"><b>Definition:</b> <a href="functions_8cpp_source.html#l00076">functions.cpp:76</a></div></div>
<div class="ttc" id="classip_container_html_a070a13e7de2e032349abc22a5533776f"><div class="ttname"><a href="classip_container.html#a070a13e7de2e032349abc22a5533776f">ipContainer::readContents</a></div><div class="ttdeci">void readContents()</div><div class="ttdef"><b>Definition:</b> <a href="ip_container_8h_source.html#l00068">ipContainer.h:68</a></div></div>
<div class="ttc" id="classnet_peers_html_a0e75bc21792d0efcd61869cca3c03c83"><div class="ttname"><a href="classnet_peers.html#a0e75bc21792d0efcd61869cca3c03c83">netPeers::mark</a></div><div class="ttdeci">void mark()</div><div class="ttdef"><b>Definition:</b> <a href="net_peers_8h_source.html#l00089">netPeers.h:89</a></div></div>
<div class="ttc" id="class_network_manager_html_a88daa7015845740fa1fb510fc9b04e11"><div class="ttname"><a href="class_network_manager.html#a88daa7015845740fa1fb510fc9b04e11">NetworkManager::ProcessMessage</a></div><div class="ttdeci">bool ProcessMessage(netMessage msg, std::list&lt; netPeers &gt;::iterator peer, bool bInbound)</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00654">NetworkManager.cpp:654</a></div></div>
<div class="ttc" id="defines_8h_html_ab8a4083c1e5d7c4172936f59e67ce798"><div class="ttname"><a href="defines_8h.html#ab8a4083c1e5d7c4172936f59e67ce798">SOCKET</a></div><div class="ttdeci">unsigned int SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00044">defines.h:44</a></div></div>
<div class="ttc" id="defines_8h_html_ae57d56be40e06a6148c41bb9c1f66eb6"><div class="ttname"><a href="defines_8h.html#ae57d56be40e06a6148c41bb9c1f66eb6">WSAEADDRINUSE</a></div><div class="ttdeci">#define WSAEADDRINUSE</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00053">defines.h:53</a></div></div>
<div class="ttc" id="classip_container_html"><div class="ttname"><a href="classip_container.html">ipContainer&lt; CNetAddr &gt;</a></div></div>
<div class="ttc" id="class_network_manager_html_af00e65d5c1f39a36f4fd7936bb2c537f"><div class="ttname"><a href="class_network_manager.html#af00e65d5c1f39a36f4fd7936bb2c537f">NetworkManager::m_hListenSocket</a></div><div class="ttdeci">SOCKET m_hListenSocket</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00053">NetworkManager.h:53</a></div></div>
<div class="ttc" id="class_network_manager_html_a75a0ee3afcd4d25adb9ff6bbb323b35c"><div class="ttname"><a href="class_network_manager.html#a75a0ee3afcd4d25adb9ff6bbb323b35c">NetworkManager::m_csPeerListOut</a></div><div class="ttdeci">cCriticalSection m_csPeerListOut</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00074">NetworkManager.h:74</a></div></div>
<div class="ttc" id="class_network_manager_html_a2cfe4223139cf58587a9f066b956cb23"><div class="ttname"><a href="class_network_manager.html#a2cfe4223139cf58587a9f066b956cb23">NetworkManager::~NetworkManager</a></div><div class="ttdeci">~NetworkManager()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00930">NetworkManager.cpp:930</a></div></div>
<div class="ttc" id="defines_8h_html_a4ba23242bee4784b72a0a170e2f975a0"><div class="ttname"><a href="defines_8h.html#a4ba23242bee4784b72a0a170e2f975a0">WSAEWOULDBLOCK</a></div><div class="ttdeci">#define WSAEWOULDBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00049">defines.h:49</a></div></div>
<div class="ttc" id="class_c_simple_ini_templ_html_a7fa211c1c768497520eab7f2014ae786"><div class="ttname"><a href="class_c_simple_ini_templ.html#a7fa211c1c768497520eab7f2014ae786">CSimpleIniTempl::GetLongValue</a></div><div class="ttdeci">long GetLongValue(const SI_CHAR *a_pSection, const SI_CHAR *a_pKey, long a_nDefault=0, bool *a_pHasMultiple=NULL) const</div><div class="ttdef"><b>Definition:</b> <a href="_simple_ini_8h_source.html#l02018">SimpleIni.h:2018</a></div></div>
<div class="ttc" id="classc_semaphore_grant_html_a21a3839adddb64863b2125238659dbd9"><div class="ttname"><a href="classc_semaphore_grant.html#a21a3839adddb64863b2125238659dbd9">cSemaphoreGrant::MoveTo</a></div><div class="ttdeci">void MoveTo(cSemaphoreGrant &amp;grant)</div><div class="ttdef"><b>Definition:</b> <a href="c_semaphore_8h_source.html#l00084">cSemaphore.h:84</a></div></div>
<div class="ttc" id="classnet_message_html"><div class="ttname"><a href="classnet_message.html">netMessage</a></div><div class="ttdef"><b>Definition:</b> <a href="net_message_8h_source.html#l00029">netMessage.h:29</a></div></div>
<div class="ttc" id="classip_container_html_a12cf39912931985fa786f3faf299bbef"><div class="ttname"><a href="classip_container.html#a12cf39912931985fa786f3faf299bbef">ipContainer::lstIP</a></div><div class="ttdeci">std::list&lt; T &gt; lstIP</div><div class="ttdef"><b>Definition:</b> <a href="ip_container_8h_source.html#l00043">ipContainer.h:43</a></div></div>
<div class="ttc" id="class_c_service_html_ac4c6d655fab3af40937f0b0c65581745"><div class="ttname"><a href="class_c_service.html#ac4c6d655fab3af40937f0b0c65581745">CService::GetSockAddr</a></div><div class="ttdeci">bool GetSockAddr(struct sockaddr *paddr, socklen_t *addrlen) const</div><div class="ttdef"><b>Definition:</b> <a href="_c_service_8cpp_source.html#l00080">CService.cpp:80</a></div></div>
<div class="ttc" id="class_network_manager_html_ad5d22fe6eb481e5998e8c455da540aba"><div class="ttname"><a href="class_network_manager.html#ad5d22fe6eb481e5998e8c455da540aba">NetworkManager::threadSocketHandler</a></div><div class="ttdeci">std::thread threadSocketHandler</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00057">NetworkManager.h:57</a></div></div>
<div class="ttc" id="defines_8h_html_ad20a801741bd20aee6186d189f0506dd"><div class="ttname"><a href="defines_8h.html#ad20a801741bd20aee6186d189f0506dd">NET_STANDARD_CATCHALL_LISTENING</a></div><div class="ttdeci">#define NET_STANDARD_CATCHALL_LISTENING</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00061">defines.h:61</a></div></div>
<div class="ttc" id="classnet_peers_html_a50b253a49909c8a0e3da923d8c4c73c0"><div class="ttname"><a href="classnet_peers.html#a50b253a49909c8a0e3da923d8c4c73c0">netPeers::listSend</a></div><div class="ttdeci">std::list&lt; netMessage &gt; listSend</div><div class="ttdef"><b>Definition:</b> <a href="net_peers_8h_source.html#l00084">netPeers.h:84</a></div></div>
<div class="ttc" id="class_c_service_html"><div class="ttname"><a href="class_c_service.html">CService</a></div><div class="ttdef"><b>Definition:</b> <a href="_c_service_8h_source.html#l00019">CService.h:19</a></div></div>
<div class="ttc" id="defines_8h_html_a407ce4b9e4c1645103d055c0eca8f5ed"><div class="ttname"><a href="defines_8h.html#a407ce4b9e4c1645103d055c0eca8f5ed">DUMP_INTERVAL</a></div><div class="ttdeci">#define DUMP_INTERVAL</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00062">defines.h:62</a></div></div>
<div class="ttc" id="defines_8h_html_ab18d3d439e4a9c8d0f73e7166e8eb376"><div class="ttname"><a href="defines_8h.html#ab18d3d439e4a9c8d0f73e7166e8eb376">MSG_DONTWAIT</a></div><div class="ttdeci">#define MSG_DONTWAIT</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00099">defines.h:99</a></div></div>
<div class="ttc" id="class_network_manager_html_a968f2d8ac0406b6f0e2bc0713013b97a"><div class="ttname"><a href="class_network_manager.html#a968f2d8ac0406b6f0e2bc0713013b97a">NetworkManager::m_interruptNet</a></div><div class="ttdeci">CThreadInterrupt m_interruptNet</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00045">NetworkManager.h:45</a></div></div>
<div class="ttc" id="defines_8h_html_a72426049acbc67e4b2adc06722ad19f0"><div class="ttname"><a href="defines_8h.html#a72426049acbc67e4b2adc06722ad19f0">NET_DEFAULT_TIME_BETWEEN_UNSUCCESSFUL</a></div><div class="ttdeci">#define NET_DEFAULT_TIME_BETWEEN_UNSUCCESSFUL</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00067">defines.h:67</a></div></div>
<div class="ttc" id="_c_service_8h_html"><div class="ttname"><a href="_c_service_8h.html">CService.h</a></div></div>
<div class="ttc" id="class_network_manager_html_a5ed61b32dd67cce5b0d03d017d380484"><div class="ttname"><a href="class_network_manager.html#a5ed61b32dd67cce5b0d03d017d380484">NetworkManager::m_pSemOutbound</a></div><div class="ttdeci">cSemaphore * m_pSemOutbound</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00075">NetworkManager.h:75</a></div></div>
<div class="ttc" id="classnet_message_html_aa53484d71941808fe5f24e9a2e82ef92"><div class="ttname"><a href="classnet_message.html#aa53484d71941808fe5f24e9a2e82ef92">netMessage::getHeader</a></div><div class="ttdeci">sHeader getHeader()</div><div class="ttdef"><b>Definition:</b> <a href="net_message_8h_source.html#l00106">netMessage.h:106</a></div></div>
<div class="ttc" id="class_network_manager_html_a47bfd57a878ecad468b8f26dc6224d03"><div class="ttname"><a href="class_network_manager.html#a47bfd57a878ecad468b8f26dc6224d03">NetworkManager::m_lstBanList</a></div><div class="ttdeci">ipContainer&lt; CNetAddr &gt; m_lstBanList</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00083">NetworkManager.h:83</a></div></div>
<div class="ttc" id="class_network_manager_html_a7838157f0e49e77f015a9326c23746b1"><div class="ttname"><a href="class_network_manager.html#a7838157f0e49e77f015a9326c23746b1">NetworkManager::ThreadOpenConnections</a></div><div class="ttdeci">void ThreadOpenConnections()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00554">NetworkManager.cpp:554</a></div></div>
<div class="ttc" id="class_network_manager_html_a7509c0b86351780fd092cf433f9795e6"><div class="ttname"><a href="class_network_manager.html#a7509c0b86351780fd092cf433f9795e6">NetworkManager::m_bfMsgProcWake</a></div><div class="ttdeci">bool m_bfMsgProcWake</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00047">NetworkManager.h:47</a></div></div>
<div class="ttc" id="class_meta_chain_html"><div class="ttname"><a href="class_meta_chain.html">MetaChain</a></div><div class="ttdef"><b>Definition:</b> <a href="_meta_chain_8h_source.html#l00027">MetaChain.h:27</a></div></div>
<div class="ttc" id="defines_8h_html_a6d24fe3ab2906c21c373505ca244f90b"><div class="ttname"><a href="defines_8h.html#a6d24fe3ab2906c21c373505ca244f90b">WSAGetLastError</a></div><div class="ttdeci">#define WSAGetLastError()</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00046">defines.h:46</a></div></div>
<div class="ttc" id="class_network_manager_html_accc4aa063b5d44ea39d517337095f24f"><div class="ttname"><a href="class_network_manager.html#accc4aa063b5d44ea39d517337095f24f">NetworkManager::m_iNetConnectTimeout</a></div><div class="ttdeci">int m_iNetConnectTimeout</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00038">NetworkManager.h:38</a></div></div>
<div class="ttc" id="class_network_manager_html_a405f2efdf4f337703c2a0f1de03868ae"><div class="ttname"><a href="class_network_manager.html#a405f2efdf4f337703c2a0f1de03868ae">NetworkManager::m_csPeerListIn</a></div><div class="ttdeci">cCriticalSection m_csPeerListIn</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00077">NetworkManager.h:77</a></div></div>
<div class="ttc" id="defines_8h_html_a633b0396ff93d336a088412a190a5072"><div class="ttname"><a href="defines_8h.html#a633b0396ff93d336a088412a190a5072">SOCKET_ERROR</a></div><div class="ttdeci">#define SOCKET_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00056">defines.h:56</a></div></div>
<div class="ttc" id="logger_8h_html_a59ab42cd81e0cabb4262992011c59a67"><div class="ttname"><a href="logger_8h.html#a59ab42cd81e0cabb4262992011c59a67">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR(logline, module)</div><div class="ttdef"><b>Definition:</b> <a href="logger_8h_source.html#l00066">logger.h:66</a></div></div>
<div class="ttc" id="defines_8h_html_a26769957ec1a2beaf223f33b66ee64ab"><div class="ttname"><a href="defines_8h.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="ttdeci">#define INVALID_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00055">defines.h:55</a></div></div>
<div class="ttc" id="class_network_manager_html_a330d81a27df12cd684b691443ce10090"><div class="ttname"><a href="class_network_manager.html#a330d81a27df12cd684b691443ce10090">NetworkManager::m_lstPeerListOut</a></div><div class="ttdeci">ipContainer&lt; netPeers &gt; m_lstPeerListOut</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00073">NetworkManager.h:73</a></div></div>
<div class="ttc" id="classc_semaphore_html"><div class="ttname"><a href="classc_semaphore.html">cSemaphore</a></div><div class="ttdef"><b>Definition:</b> <a href="c_semaphore_8h_source.html#l00015">cSemaphore.h:15</a></div></div>
<div class="ttc" id="class_network_manager_html_abae29b81b32efa712838f52f8aabf236"><div class="ttname"><a href="class_network_manager.html#abae29b81b32efa712838f52f8aabf236">NetworkManager::m_mutexMsgProc</a></div><div class="ttdeci">boost::mutex m_mutexMsgProc</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00049">NetworkManager.h:49</a></div></div>
<div class="ttc" id="class_c_thread_interrupt_html_a399a6b881ef3e107eb956239679c5026"><div class="ttname"><a href="class_c_thread_interrupt.html#a399a6b881ef3e107eb956239679c5026">CThreadInterrupt::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="c_thread_interrupt_8cpp_source.html#l00015">cThreadInterrupt.cpp:15</a></div></div>
<div class="ttc" id="class_network_manager_html_af5e6b64265dc0147775f524a01e6d6f1"><div class="ttname"><a href="class_network_manager.html#af5e6b64265dc0147775f524a01e6d6f1">NetworkManager::ThreadMessageHandler</a></div><div class="ttdeci">void ThreadMessageHandler()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00599">NetworkManager.cpp:599</a></div></div>
<div class="ttc" id="class_network_manager_html_afb627137857f6ef3b19fc1208a876907"><div class="ttname"><a href="class_network_manager.html#afb627137857f6ef3b19fc1208a876907">NetworkManager::m_iMaxOutboundConnections</a></div><div class="ttdeci">int m_iMaxOutboundConnections</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00040">NetworkManager.h:40</a></div></div>
<div class="ttc" id="defines_8h_html_a399f8172f8495a5d0904c6040e471a1e"><div class="ttname"><a href="defines_8h.html#a399f8172f8495a5d0904c6040e471a1e">NET_DEFAULT_MAX_OUTGOING_CONNECTIONS</a></div><div class="ttdeci">#define NET_DEFAULT_MAX_OUTGOING_CONNECTIONS</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00065">defines.h:65</a></div></div>
<div class="ttc" id="class_c_net_addr_html"><div class="ttname"><a href="class_c_net_addr.html">CNetAddr</a></div><div class="ttdef"><b>Definition:</b> <a href="_c_net_addr_8h_source.html#l00026">CNetAddr.h:26</a></div></div>
<div class="ttc" id="class_c_net_addr_html_a09168d1f3620bcb0ef396359d5764e54"><div class="ttname"><a href="class_c_net_addr.html#a09168d1f3620bcb0ef396359d5764e54">CNetAddr::toStringIP</a></div><div class="ttdeci">std::string toStringIP() const</div><div class="ttdef"><b>Definition:</b> <a href="_c_net_addr_8cpp_source.html#l00283">CNetAddr.cpp:283</a></div></div>
<div class="ttc" id="_convert_u_t_f_8c_html_a65e9886d74aaee76545e83dd09011727"><div class="ttname"><a href="_convert_u_t_f_8c.html#a65e9886d74aaee76545e83dd09011727">false</a></div><div class="ttdeci">#define false</div><div class="ttdef"><b>Definition:</b> <a href="_convert_u_t_f_8c_source.html#l00056">ConvertUTF.c:56</a></div></div>
<div class="ttc" id="class_network_manager_html_a5c460478d30acee5d5bd9082b9eb40cb"><div class="ttname"><a href="class_network_manager.html#a5c460478d30acee5d5bd9082b9eb40cb">NetworkManager::threadMessageHandler</a></div><div class="ttdeci">std::thread threadMessageHandler</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00059">NetworkManager.h:59</a></div></div>
<div class="ttc" id="classnet_peers_html_a0a16c3adbdb484356928cad339b8f06a"><div class="ttname"><a href="classnet_peers.html#a0a16c3adbdb484356928cad339b8f06a">netPeers::markDestroy</a></div><div class="ttdeci">void markDestroy()</div><div class="ttdef"><b>Definition:</b> <a href="net_peers_8h_source.html#l00087">netPeers.h:87</a></div></div>
<div class="ttc" id="class_network_manager_html_a3dc6503bbd3b96fa973d699fbb38e06e"><div class="ttname"><a href="class_network_manager.html#a3dc6503bbd3b96fa973d699fbb38e06e">NetworkManager::startListeningSocket</a></div><div class="ttdeci">bool startListeningSocket()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00116">NetworkManager.cpp:116</a></div></div>
<div class="ttc" id="defines_8h_html_a133e7d33cddac993d3357690aa64c797"><div class="ttname"><a href="defines_8h.html#a133e7d33cddac993d3357690aa64c797">NET_DEFAULT_MAX_INCOMING_CONNECTIONS</a></div><div class="ttdeci">#define NET_DEFAULT_MAX_INCOMING_CONNECTIONS</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00066">defines.h:66</a></div></div>
<div class="ttc" id="class_network_manager_html_a26c646f9943d9ddc87e91104ce850b0c"><div class="ttname"><a href="class_network_manager.html#a26c646f9943d9ddc87e91104ce850b0c">NetworkManager::Interrupt</a></div><div class="ttdeci">void Interrupt()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00940">NetworkManager.cpp:940</a></div></div>
<div class="ttc" id="classnet_peers_html"><div class="ttname"><a href="classnet_peers.html">netPeers</a></div><div class="ttdef"><b>Definition:</b> <a href="net_peers_8h_source.html#l00025">netPeers.h:25</a></div></div>
<div class="ttc" id="classip_container_html_adbfd3103fc17563d8d2b4d17c351902a"><div class="ttname"><a href="classip_container.html#adbfd3103fc17563d8d2b4d17c351902a">ipContainer::entryExists</a></div><div class="ttdeci">bool entryExists(T *obj)</div><div class="ttdef"><b>Definition:</b> <a href="ip_container_8h_source.html#l00154">ipContainer.h:154</a></div></div>
<div class="ttc" id="functions_8h_html_ac481a378af0229bf71e3d9fee7b938ad"><div class="ttname"><a href="functions_8h.html#ac481a378af0229bf71e3d9fee7b938ad">TraceThread</a></div><div class="ttdeci">void TraceThread(const char *name, Callable func)</div><div class="ttdef"><b>Definition:</b> <a href="functions_8h_source.html#l00051">functions.h:51</a></div></div>
<div class="ttc" id="class_c_service_html_a27dd2cf9191d05c1b1d870d64b42388c"><div class="ttname"><a href="class_c_service.html#a27dd2cf9191d05c1b1d870d64b42388c">CService::toString</a></div><div class="ttdeci">std::string toString() const</div><div class="ttdef"><b>Definition:</b> <a href="_c_service_8cpp_source.html#l00135">CService.cpp:135</a></div></div>
<div class="ttc" id="class_c_net_addr_html_a1f0b23aca4ca78c11735d13f3583b7ad"><div class="ttname"><a href="class_c_net_addr.html#a1f0b23aca4ca78c11735d13f3583b7ad">CNetAddr::SetRaw</a></div><div class="ttdeci">void SetRaw(Network network, const uint8_t *data)</div><div class="ttdef"><b>Definition:</b> <a href="_c_net_addr_8cpp_source.html#l00092">CNetAddr.cpp:92</a></div></div>
<div class="ttc" id="classc_semaphore_grant_html"><div class="ttname"><a href="classc_semaphore_grant.html">cSemaphoreGrant</a></div><div class="ttdef"><b>Definition:</b> <a href="c_semaphore_8h_source.html#l00054">cSemaphore.h:54</a></div></div>
<div class="ttc" id="_c_net_addr_8h_html"><div class="ttname"><a href="_c_net_addr_8h.html">CNetAddr.h</a></div></div>
<div class="ttc" id="namespace_m_c_p39_1_1language_html_af60b620aedf828cf1e21522d250ccf14"><div class="ttname"><a href="namespace_m_c_p39_1_1language.html#af60b620aedf828cf1e21522d250ccf14">MCP39::language::it</a></div><div class="ttdeci">const dictionary it</div><div class="ttdef"><b>Definition:</b> <a href="dictionairy_8cpp_source.html#l06169">dictionairy.cpp:6169</a></div></div>
<div class="ttc" id="logger_8h_html_ae1641999093a47ba019589c5dad08770"><div class="ttname"><a href="logger_8h.html#ae1641999093a47ba019589c5dad08770">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG(logline, module)</div><div class="ttdef"><b>Definition:</b> <a href="logger_8h_source.html#l00065">logger.h:65</a></div></div>
<div class="ttc" id="classnet_peers_html_a1d22d688a864ba859b06f7b34d51b01e"><div class="ttname"><a href="classnet_peers.html#a1d22d688a864ba859b06f7b34d51b01e">netPeers::toDestroy</a></div><div class="ttdeci">bool toDestroy()</div><div class="ttdef"><b>Definition:</b> <a href="net_peers_8h_source.html#l00088">netPeers.h:88</a></div></div>
<div class="ttc" id="class_network_manager_html_ae09548303d78f6f3f97b8722e5685205"><div class="ttname"><a href="class_network_manager.html#ae09548303d78f6f3f97b8722e5685205">NetworkManager::m_pMC</a></div><div class="ttdeci">MetaChain * m_pMC</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00036">NetworkManager.h:36</a></div></div>
<div class="ttc" id="structs_header_html_a4ad712cc4957b459242b9c2f585b276e"><div class="ttname"><a href="structs_header.html#a4ad712cc4957b459242b9c2f585b276e">sHeader::ui16tSubject</a></div><div class="ttdeci">uint16_t ui16tSubject</div><div class="ttdef"><b>Definition:</b> <a href="net_message_8h_source.html#l00024">netMessage.h:24</a></div></div>
<div class="ttc" id="class_network_manager_html_ad519fe4c3fef08ebc88324a53a0ceea8"><div class="ttname"><a href="class_network_manager.html#ad519fe4c3fef08ebc88324a53a0ceea8">NetworkManager::m_abflagInterruptMsgProc</a></div><div class="ttdeci">std::atomic&lt; bool &gt; m_abflagInterruptMsgProc</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00046">NetworkManager.h:46</a></div></div>
<div class="ttc" id="classnet_message_html_afc70e17f053acb1135ae3f8784f474da"><div class="ttname"><a href="classnet_message.html#afc70e17f053acb1135ae3f8784f474da">netMessage::getData</a></div><div class="ttdeci">char * getData()</div><div class="ttdef"><b>Definition:</b> <a href="net_message_8h_source.html#l00103">netMessage.h:103</a></div></div>
<div class="ttc" id="structs_header_html_a14d4cc5c72ce487709389831e030378a"><div class="ttname"><a href="structs_header.html#a14d4cc5c72ce487709389831e030378a">sHeader::ui32tPayloadSize</a></div><div class="ttdeci">uint32_t ui32tPayloadSize</div><div class="ttdef"><b>Definition:</b> <a href="net_message_8h_source.html#l00022">netMessage.h:22</a></div></div>
<div class="ttc" id="class_network_manager_html_ac585f836f81265b24c9fac58e8563055"><div class="ttname"><a href="class_network_manager.html#ac585f836f81265b24c9fac58e8563055">NetworkManager::Stop</a></div><div class="ttdeci">void Stop()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00951">NetworkManager.cpp:951</a></div></div>
<div class="ttc" id="class_meta_chain_html_a421a4eede44c6a594e6ea406f0d506a4"><div class="ttname"><a href="class_meta_chain.html#a421a4eede44c6a594e6ea406f0d506a4">MetaChain::isFN</a></div><div class="ttdeci">bool isFN()</div><div class="ttdef"><b>Definition:</b> <a href="_meta_chain_8h_source.html#l00076">MetaChain.h:76</a></div></div>
<div class="ttc" id="class_network_manager_html_ac0b1d84b9a23c78586d18e2d8ca8e344"><div class="ttname"><a href="class_network_manager.html#ac0b1d84b9a23c78586d18e2d8ca8e344">NetworkManager::ThreadSocketHandler</a></div><div class="ttdeci">void ThreadSocketHandler()</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00225">NetworkManager.cpp:225</a></div></div>
<div class="ttc" id="classc_critical_section_html"><div class="ttname"><a href="classc_critical_section.html">cCriticalSection</a></div><div class="ttdef"><b>Definition:</b> <a href="c_critical_section_8h_source.html#l00100">cCriticalSection.h:100</a></div></div>
<div class="ttc" id="_network_manager_8h_html"><div class="ttname"><a href="_network_manager_8h.html">NetworkManager.h</a></div></div>
<div class="ttc" id="defines_8h_html_a8eaf06e7d68fc5e5bdeeafcbe1f8bc76"><div class="ttname"><a href="defines_8h.html#a8eaf06e7d68fc5e5bdeeafcbe1f8bc76">NET_DEFAULT_CONNECT_TIMEOUT</a></div><div class="ttdeci">#define NET_DEFAULT_CONNECT_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="defines_8h_source.html#l00063">defines.h:63</a></div></div>
<div class="ttc" id="class_network_manager_html_a278ce13b8d97b651bafcdd1835e08b16"><div class="ttname"><a href="class_network_manager.html#a278ce13b8d97b651bafcdd1835e08b16">NetworkManager::handleMessage</a></div><div class="ttdeci">void handleMessage(ipContainer&lt; netPeers &gt; *peers, cCriticalSection *cs, bool bInbound)</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8cpp_source.html#l00617">NetworkManager.cpp:617</a></div></div>
<div class="ttc" id="class_meta_chain_html_a40346e4a086fda36f926daa11259d46f"><div class="ttname"><a href="class_meta_chain.html#a40346e4a086fda36f926daa11259d46f">MetaChain::incrementNewerVersionTicker</a></div><div class="ttdeci">void incrementNewerVersionTicker()</div><div class="ttdef"><b>Definition:</b> <a href="_meta_chain_8cpp_source.html#l00153">MetaChain.cpp:153</a></div></div>
<div class="ttc" id="class_network_manager_html_a836732e6ad8589afc2f6119b98eb4de6"><div class="ttname"><a href="class_network_manager.html#a836732e6ad8589afc2f6119b98eb4de6">NetworkManager::m_pSemInbound</a></div><div class="ttdeci">cSemaphore * m_pSemInbound</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00078">NetworkManager.h:78</a></div></div>
<div class="ttc" id="classip_container_html_a6b77e4dd4e9681f1a8aa1da7c997ce07"><div class="ttname"><a href="classip_container.html#a6b77e4dd4e9681f1a8aa1da7c997ce07">ipContainer::writeContents</a></div><div class="ttdeci">void writeContents(bool bAttach=false)</div><div class="ttdef"><b>Definition:</b> <a href="ip_container_8h_source.html#l00121">ipContainer.h:121</a></div></div>
<div class="ttc" id="class_network_manager_html_ab6e9b8711788bbfb340738ff92b302be"><div class="ttname"><a href="class_network_manager.html#ab6e9b8711788bbfb340738ff92b302be">NetworkManager::m_bActiveNetwork</a></div><div class="ttdeci">bool m_bActiveNetwork</div><div class="ttdef"><b>Definition:</b> <a href="_network_manager_8h_source.html#l00042">NetworkManager.h:42</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_fc4c7f03e1a69a98c370fae55a743828.html">network</a></li><li class="navelem"><a class="el" href="_network_manager_8cpp.html">NetworkManager.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
